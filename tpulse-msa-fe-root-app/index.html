<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Security-Policy"
    content="default-src *  data: blob: 'unsafe-inline' 'unsafe-eval'; script-src * data: blob: 'self' 'unsafe-eval' 'unsafe-inline' ; connect-src * 'unsafe-inline'; img-src * data: blob: 'unsafe-inline'; frame-src *; style-src * data: blob: 'unsafe-inline'; font-src * data: blob: 'unsafe-inline';" />
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>T-Pulse</title>
  <base href="/" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="importmap-type" content="systemjs-importmap" />
  <script src="./node_modules/jquery/dist/jquery.min.js"></script>
  <style>
    #fileInput {
      display: none;
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;600;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet" />
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/single-spa/5.5.0/system/single-spa.min.js"
    as="script" crossorigin="anonymous" />
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"
    integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous" />
  <link href="https://cdn.jsdelivr.net/npm/@ng-select/ng-select@8.1.1/themes/default.theme.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
    crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"
    integrity="sha384-DyZ88mC6Up2uqS4h/KRgHuoeGwBcD4Ng9SiP4dIRy0EXTlnuz47vAwmeGwVChigm" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ngx-videogular@13.2.4/fonts/videogular.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@swimlane/ngx-datatable@20.0.0/assets/icons.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@swimlane/ngx-datatable@20.0.0/index.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@swimlane/ngx-datatable@20.0.0/themes/bootstrap.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@swimlane/ngx-datatable@20.0.0/themes/dark.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ng-pick-datetime@7.0.0/assets/style/picker.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@swimlane/ngx-datatable@20.0.0/themes/material.css" />
  <script src="/node_modules/ngx-extended-pdf-viewer/assets/pdf-2.10.562.min.js"></script>
  <script src="/node_modules/ngx-extended-pdf-viewer/assets/viewer-2.10.562.min.js"></script>
  <script src="/node_modules/ngx-extended-pdf-viewer/assets/pdf.worker-2.10.562.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/hls.js/1.1.3/hls.min.js"
    integrity="sha512-9/QWM/n+3R732nUgQI5bm8RXpYDTSs4Y2tBq/Jbv6pB88ik9P4M4856ykuTHMsYJu0f8fsmbiRJ5RC906DTBUQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ng-pick-datetime@7.0.0/assets/style/picker.min.css" />
  <link rel="stylesheet" href="https://unpkg.com/@progress/kendo-theme-default/dist/all.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/assets/css/scalize.css" />
  <script src="/assets/js/scalize.js"></script>
  <script src="/assets/js/UnityLoader.js"></script>
  <link rel="icon" type="image/x-icon" href="favicon.ico" />
  <script>
    let fileName = window.location.href.includes('localhost') ? 'application-configurations.json' : 'application-configurations-prod.json';
    $(function () {
      $.getJSON(
        "assets/json/" + fileName,
        function (data) {
          sessionStorage.setItem(
            "application-configuration",
            JSON.stringify(data)
          );
          sessionStorage.setItem("modules", JSON.stringify(data["modules"]));
          sessionStorage.setItem("url", data["url"]);
          sessionStorage.setItem("apiUrl", data["apiUrl"]);
          sessionStorage.setItem("wsUrl", data["websocketUrl"]);
          sessionStorage.setItem('matomoSiteId', data.matomoSiteId);
          sessionStorage.setItem('matomoTrackerUrl', data.matomoTrackerUrl);
        }
      );
    });
  </script>
  <script type="systemjs-importmap">
    {
      "imports": {
        "central-dashboard": "http://localhost:4299/main.js",
        "employee-wellness": "http://localhost:4277/main.js",
        "cognito-auth": "http://localhost:4201/main.js",
        "central-tower": "http://localhost:4401/main.js",
        "productivity-monitoring": "http://localhost:4402/main.js",
        "safety-and-surveillance": "http://localhost:4204/main.js",
        "security-assistant-lsa": "http://localhost:4900/main.js",
        "live-streaming":"http://localhost:4206/main.js",
        "manpower-counting":"http://localhost:4207/main.js",
        "vendor-management":"http://localhost:4208/main.js",
        "vendor-auth":"http://localhost:4209/main.js",
        "admin-app":"http://localhost:4210/main.js",
        "container": "http://localhost:4233/main.js",
        "license-expired":"http://localhost:4215/main.js",
        "style-guide": "http://localhost:9000/detect-style-guide.js",
        "camera-configuration":"http://localhost:4216/main.js",
        "inspection":"http://localhost:4500/main.js",
        "single-spa": "https://cdnjs.cloudflare.com/ajax/libs/single-spa/5.5.0/system/single-spa.min.js",
        "single-spa-layout": "https://unpkg.com/single-spa-layout@1.0.0-beta.2/dist/system/single-spa-layout.min.js"
      }
    }
    </script>

  <script src="https://unpkg.com/core-js-bundle@3.1.4/minified.js"></script>
  <script src="https://unpkg.com/zone.js@0.10.3/dist/zone.js"></script>
  <script src="https://unpkg.com/import-map-overrides@1.15.1/dist/import-map-overrides.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/systemjs/4.0.0/system.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/systemjs/4.0.0/extras/amd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/systemjs/4.0.0/extras/named-exports.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/systemjs/4.0.0/extras/named-register.min.js"></script>
  <script>
    System.import("style-guide");
  </script>
  <template id="single-spa-layout">
    <single-spa-router>
      <nav class="topnav">
        <application name="container"></application>
      </nav>
      <!-- <redirect from="/" to="auth"></redirect> -->
      <!-- <redirect from="/" to="https://mfa-fe-test.auth.ap-northeast-1.amazoncognito.com/login?client_id=32i6c0rd9h4t89rbqpjn1ikaqm&response_type=code&scope=openid&redirect_uri=https://google.com"></redirect> -->
      <div class="main-content" style="height: 85vh">
        <route path="cognito-auth">
          <application name="cognito-auth"></application>
        </route>
        <route path="license-expired">
          <application name="license-expired"></application>
        </route>
        <route path="safety-and-surveillance">
          <application name="safety-and-surveillance"></application>
        </route>
        <route path="security-assistant-lsa">
          <application name="security-assistant-lsa"></application>
        </route>
        <route path="security-assistant-perimeter">
          <application name="security-assistant-perimeter"></application>
        </route>
        <route path="employee-wellness">
          <application name="employee-wellness"></application>
        </route>
        <route path="central-dashboard">
          <application name="central-dashboard"></application>
        </route>
        <route path="live-streaming">
          <application name="live-streaming"></application>
        </route>
        <route path="manpower-counting">
          <application name="manpower-counting"></application>
        </route>
        <route path="vendor-management">
          <application name="vendor-management"></application>
        </route>
        <route path="vendor-auth">
          <application name="vendor-auth"></application>
        </route>
        <route path="admin-app">
          <application name="admin-app"></application>
        </route>
        <route path="camera-configuration">
          <application name="camera-configuration"></application>
        </route>
        <route path="progress-monitoring">
          <application name="progress-monitoring"></application>
        </route>
        <route path="schedule-control">
          <application name="schedule-control"></application>
        </route>
        <route path="inspection">
          <application name="inspection"></application>
        </route>
        <route path="central-tower"></route>
          <application name="central-tower"></application>
        </route>
        <route path="productivity-monitoring">
          <application name="productivity-monitoring"></application>
        </route>
      </div>
    </single-spa-router>
  </template>
</head>

<body>
  <script>
    var global = global || window;
    var Buffer = Buffer || [];
    var process = process || {
      env: { DEBUG: undefined },
      version: [],
    };
  </script>
  <script>
    Promise.all([
      System.import("single-spa"),
      System.import("single-spa-layout"),
    ]).then(([singleSpa, singleSpaLayout]) => {
      const {
        constructApplications,
        constructLayoutEngine,
        constructRoutes,
      } = singleSpaLayout;
      const { registerApplication, start } = singleSpa;

      const routes = constructRoutes(
        document.querySelector("#single-spa-layout")
      );

      const applications = constructApplications({
        routes,
        loadApp({ name }) {
          return System.import(name);
        },
      });
      const layoutEngine = constructLayoutEngine({ routes, applications });
      applications.forEach(registerApplication);
      start();

      let currentRoute = window.location.href.replace(sessionStorage.getItem('url'), '').split('/')[0];
      let isUserLoggedIn = sessionStorage.getItem('userLoggedIn')
      if (!applications.filter(app => app.name == currentRoute).length && !isUserLoggedIn && !window.location.href.includes("company_id=") && !window.location.href.includes("vendor-auth/signin"))
        singleSpa.navigateToUrl('/cognito-auth/sign-in')

      window.addEventListener("successful-sign-in", (evt) => {
        if (evt.detail.navigateToApp == true) {
          var accessibleModules = JSON.parse(
            sessionStorage.getItem("modules")
          );
          // singleSpa.navigateToUrl(accessibleModules[0].routeUrl);
          // window.dispatchEvent(new CustomEvent('show-welcome-message'))
          // window.location.reload();
          const selectedStreamNavigation = JSON.parse(sessionStorage.getItem('selectedStreamNavigation')) || JSON.parse(sessionStorage.getItem('selectedModuleNavigation'));
          if (selectedStreamNavigation && selectedStreamNavigation.module) {
            const selectedModuleIndex = accessibleModules.findIndex(x => x.identifier == selectedStreamNavigation.module);
            if (selectedModuleIndex > -1) {
              singleSpa.navigateToUrl(accessibleModules[selectedModuleIndex].routeUrl);
            }
            else {
              let allModules = JSON.parse(sessionStorage.getItem('selectedPlantAccessModules'))
              let boolean = false;
              allModules?.forEach((val1, ind1) => {
                val1?.modules?.forEach((val2, ind2) => {
                  if (val2?.disabled == false && boolean == false) {
                    boolean = true;
                    if(JSON.parse(sessionStorage.getItem('isControlTowerAccess'))){
                      singleSpa.navigateToUrl('central-tower/dashboard');
                    }else{
                      singleSpa.navigateToUrl(val2?.route_url);
                    }
                  }
                })
              })
              // singleSpa.navigateToUrl(accessibleModules[0].routeUrl);
            }
            window.location.reload();
          }
          else {
            let allModules = JSON.parse(sessionStorage.getItem('selectedPlantAccessModules'))
            let boolean = false;
            allModules?.forEach((val1, ind1) => {
              val1?.modules?.forEach((val2, ind2) => {
                if (val2?.disabled == false && boolean == false) {
                  boolean = true;
                  if(JSON.parse(sessionStorage.getItem('isControlTowerAccess'))){
                      singleSpa.navigateToUrl('central-tower/dashboard');
                  }else{
                      singleSpa.navigateToUrl(val2?.route_url);
                  }
                }
              })
            })
            // singleSpa.navigateToUrl(accessibleModules[0].routeUrl);
            window.location.reload();
          }

        } else {
          singleSpa.navigateToUrl("/central-dashboard");
          window.location.reload();
        }
      });

      window.addEventListener("plant-selected", (evt) => {
        var accessibleModules = JSON.parse(
          sessionStorage.getItem("accessible-modules")
        );
        const selectedObservation = JSON.parse(sessionStorage.getItem('selectedObservation'))
        const selectedStreamNavigation = JSON.parse(sessionStorage.getItem('selectedStreamNavigation'))
        if (selectedObservation && selectedObservation.module) {
          const selectedModuleIndex = accessibleModules.findIndex(x => x.identifier == selectedObservation.module);
          if (selectedModuleIndex > -1) {
            singleSpa.navigateToUrl(accessibleModules[selectedModuleIndex].routeUrl);
          }
          else {
            singleSpa.navigateToUrl(accessibleModules[0].routeUrl);
          }
        }
        else if (selectedStreamNavigation && selectedStreamNavigation.module) {
          const selectedModuleIndex = accessibleModules.findIndex(x => x.identifier == selectedStreamNavigation.module);
          if (selectedModuleIndex > -1) {
            singleSpa.navigateToUrl(accessibleModules[selectedModuleIndex].routeUrl);
          }
          else {
            singleSpa.navigateToUrl(accessibleModules[0].routeUrl);
          }
        }
        else {
          singleSpa.navigateToUrl(accessibleModules[0].routeUrl);
        }
        window.location.reload();
      });

      window.addEventListener("central-dashboard", (evt) => {
        singleSpa.navigateToUrl("/central-dashboard");
        window.location.reload();
      });
      window.addEventListener("license-expired", (evt) => {
        singleSpa.navigateToUrl("/license-expired");
        //window.location.reload();
      });
      window.addEventListener("observation-selected", (evt) => {
        singleSpa.navigateToUrl("/safety-and-surveillance/observations");
        // window.location.reload();
      });
      window.addEventListener("analytics-selected", (evt) => {
        singleSpa.navigateToUrl('/safety-and-surveillance/dashboard');
        // window.location.reload();
      });

      window.addEventListener("notifications-saved", (evt) => {
        singleSpa.navigateToUrl('/safety-and-surveillance/dashboard');
      })


      window.addEventListener("navigate-from-notification", (evt) => {
        if(evt.detail.type == "obs_upload") {
          if(window.location.href.split("/").includes('observations')) {
            window.dispatchEvent(new CustomEvent('in-page-obs-nav', {detail: evt.detail}))
          } else {
            window.dispatchEvent(new CustomEvent('in-page-obs-nav', {detail: evt.detail}))
            singleSpa.navigateToUrl('/safety-and-surveillance/observations');
          }
        } else if(evt.detail.type == "start_stream") {
          singleSpa.navigateToUrl('/live-streaming/dashboard');
        }
      })

      window.addEventListener("notification-settings", (evt) => {
        singleSpa.navigateToUrl("/cognito-auth/notification");
        window.location.reload();
      });
      window.addEventListener("successful-sign-up", (evt) => {
        singleSpa.navigateToUrl("/cognito-auth/sign-in");
        window.location.reload();
      });
      window.addEventListener("Log-out", (evt) => {
        // console.log(evt);
        // sessionStorage.setItem('welcomeMsgShown', JSON.stringify(true))
        sessionStorage.clear();
        localStorage.clear();

        sessionStorage.setItem("company-host", window.location.host);
        // setTimeout(() => {
        singleSpa.navigateToUrl("/cognito-auth/sign-in");
        // }, 100);
        $(function () {
          $.getJSON(
            "assets/json/application-configurations.json",
            function (data) {
              sessionStorage.setItem(
                "application-configuration",
                JSON.stringify(data)
              );
              sessionStorage.setItem(
                "modules",
                JSON.stringify(data["modules"])
              );
              sessionStorage.setItem("url", data["url"]);
              sessionStorage.setItem("apiUrl", data["apiUrl"]);
              sessionStorage.setItem("wsUrl", data["websocketUrl"]);
            }
          );
        });
        window.location.reload();
      });
      window.addEventListener("userNotAuthenticated", (evt) => {
        singleSpa.navigateToUrl("/cognito-auth/sign-in");
        window.location.reload();
      });

      window.addEventListener("vmUserNotAuthentication", (ev) => {
        singleSpa.navigateToUrl("/vendor-auth/signin");
        window.location.reload();
      });

      window.addEventListener("change-password", (evt) => {
        // sessionStorage.clear();
        sessionStorage.setItem("reset-password", JSON.stringify(true));
        singleSpa.navigateToUrl("/cognito-auth/sign-in");
        window.location.reload();
      });
      window.addEventListener("vendor-module", (evt) => {
        console.log("vendor module called");
        singleSpa.navigateToUrl("/vendor-management/vendor/inventory-form");
        window.location.reload();
      });

      window.addEventListener("vendor-log-out", (ev) => {
        sessionStorage.clear();
        localStorage.clear();
        singleSpa.navigateToUrl("/vendor-auth/signin");
        window.location.reload();
      });

      window.addEventListener("admin-login", (ev) => {
        singleSpa.navigateToUrl("/admin-app/uam");
        sessionStorage.setItem(
          "navigated-to-application",
          JSON.stringify(false)
        );
        window.location.reload();
      });

      window.addEventListener("notification-settings", (evt) => {
        singleSpa.navigateToUrl("/cognito-auth/notification");
        window.location.reload();
      });

      if (window.location.pathname == "/") {
        if (!sessionStorage.getItem("access-token")) {
          // console.log(window.location.href.split("?"))
          if (window.location.href.split("?").length > 1) {
            let queryParams = window.location.href.split("?")[1].split("&");
            selectedPlant = queryParams.find((item) => item.slice(0, 9) === "plant_id=").split('=')[1]
            let company_id = queryParams.find((item) => item.slice(0, 11) === "company_id=").split('=')[1]
            sessionStorage.setItem('selectedPlant', selectedPlant)
            sessionStorage.setItem('company-id', company_id)
            sessionStorage.setItem('selectedModuleNavigation', JSON.stringify({
              module: queryParams
                .find((item) => item.slice(0, 7) === "module=")
                .split("=")[1],
            }));
            if (queryParams.includes("module=safety-and-surveillance")) {
              if (queryParams.includes("page=observations")) {
                sessionStorage.setItem(
                  "selectedObservation",
                  JSON.stringify({
                    plant_id: queryParams
                      .find((item) => item.slice(0, 9) === "plant_id=")
                      .split("=")[1],
                    page: queryParams
                      .find((item) => item.slice(0, 5) === "page=")
                      .split("=")[1],
                    unit: queryParams
                      .find((item) => item.slice(0, 5) === "unit=")
                      .split("=")[1].split('+').join(' '),
                    id: queryParams
                      .find((item) => item.slice(0, 3) === "id=")
                      .split("=")[1],
                  })
                );
              } else if (queryParams.includes("page=actions")) {
                sessionStorage.setItem(
                  "selectedActionNavigation",
                  JSON.stringify({
                    plant_id: queryParams
                      .find((item) => item.slice(0, 9) === "plant_id=")
                      .split("=")[1],
                    page: queryParams
                      .find((item) => item.slice(0, 5) === "page=")
                      .split("=")[1],
                    id: queryParams
                      .find((item) => item.slice(0, 3) === "id=")
                      .split("=")[1],
                  })
                );
              } else if (queryParams.includes("page=incidents")) {
                sessionStorage.setItem(
                  "selectedIncidentNavigation",
                  JSON.stringify({
                    plant_id: queryParams
                      .find((item) => item.slice(0, 9) === "plant_id=")
                      .split("=")[1],
                    page: queryParams
                      .find((item) => item.slice(0, 5) === "page=")
                      .split("=")[1],
                    id: queryParams
                      .find((item) => item.slice(0, 3) === "id=")
                      .split("=")[1],
                  })
                );
              }
            }
            // code for email navigations live-streaming 
            if (queryParams.includes("module=live-streaming")) {
              if (queryParams.includes("page=dashboard")) {
                sessionStorage.setItem(
                  "selectedStreamNavigation",
                  JSON.stringify({
                    module: queryParams
                      .find((item) => item.slice(0, 7) === "module=")
                      .split("=")[1],
                    plant_id: queryParams
                      .find((item) => item.slice(0, 9) === "plant_id=")
                      .split("=")[1],
                    page: queryParams
                      .find((item) => item.slice(0, 5) === "page=")
                      .split("=")[1],
                    is_live: queryParams
                      .find((item) => item.slice(0, 8) === "is_live=")
                      .split("=")[1],
                    unit_id: queryParams
                      .find((item) => item.slice(0, 8) === "unit_id=")
                      .split("=")[1],
                    zone_id: queryParams
                      .find((item) => item.slice(0, 8) === "zone_id=")
                      .split("=")[1],
                    id: queryParams
                      .find((item) => item.slice(0, 3) === "id=")
                      .split("=")[1],
                    page_number: queryParams
                    .find((item) => item.slice(0, 12) === "page_number=")
                    .split("=")[1],
                  })
                );
              }
            }
            //security assistant perimeter  email navigations
            if (queryParams.includes("module=security-assistant-perimeter")) {
              if (queryParams.includes("page=observations")) {
                sessionStorage.setItem(
                  "selectedScaLsaObservation",
                  JSON.stringify({
                    plant_id: queryParams
                      .find((item) => item.slice(0, 9) === "plant_id=")
                      .split("=")[1],
                    page: queryParams
                      .find((item) => item.slice(0, 5) === "page=")
                      .split("=")[1],
                    unit: queryParams
                      .find((item) => item.slice(0, 5) === "unit=")
                      .split("=")[1].split('+').join(' '),
                    id: queryParams
                      .find((item) => item.slice(0, 3) === "id=")
                      .split("=")[1],
                  })
                );
              } else if (queryParams.includes("page=actions")) {
                sessionStorage.setItem(
                  "selectedScaLsaActionNavigation",
                  JSON.stringify({
                    plant_id: queryParams
                      .find((item) => item.slice(0, 9) === "plant_id=")
                      .split("=")[1],
                    page: queryParams
                      .find((item) => item.slice(0, 5) === "page=")
                      .split("=")[1],
                    id: queryParams
                      .find((item) => item.slice(0, 3) === "id=")
                      .split("=")[1],
                  })
                );
              } else if (queryParams.includes("page=incidents")) {
                sessionStorage.setItem(
                  "selectedScaLsaIncidentNavigation",
                  JSON.stringify({
                    plant_id: queryParams
                      .find((item) => item.slice(0, 9) === "plant_id=")
                      .split("=")[1],
                    page: queryParams
                      .find((item) => item.slice(0, 5) === "page=")
                      .split("=")[1],
                    id: queryParams
                      .find((item) => item.slice(0, 3) === "id=")
                      .split("=")[1],
                  })
                );
              }
            }
           
            if (queryParams.includes("module=schedule-control")) {
              if (queryParams.includes("page=unit")) {
                sessionStorage.setItem(
                  "selectedTask",
                  JSON.stringify({
                    plant_id: queryParams
                      .find((item) => item.slice(0, 9) === "plant_id=")
                      .split("=")[1],
                    page: queryParams
                      .find((item) => item.slice(0, 5) === "page=")
                      .split("=")[1],
                    tab: queryParams
                      .find((item) => item.slice(0, 4) === "tab=")
                      .split("=")[1],
                    unit: queryParams
                      .find((item) => item.slice(0, 5) === "unit=")
                      .split("=")[1],
                    id: queryParams
                      .find((item) => item.slice(0, 3) === "id=")
                      .split("=")[1],
                    department: queryParams
                      .find((item) => item.slice(0, 11) === "department=")
                      .split("=")[1],
                    equipment: queryParams
                      .find((item) => item.slice(0, 19) === "equipment_category=")
                      .split("=")[1],
                  })
                );
              } else if (queryParams.includes("page=inspection")) {
                sessionStorage.setItem(
                  "selectedObsRec",
                  JSON.stringify({
                    plant_id: queryParams
                      .find((item) => item.slice(0, 9) === "plant_id=")
                      .split("=")[1],
                    page: queryParams
                      .find((item) => item.slice(0, 5) === "page=")
                      .split("=")[1],
                    tab: queryParams
                      .find((item) => item.slice(0, 4) === "tab=")
                      .split("=")[1],
                    unit: queryParams
                      .find((item) => item.slice(0, 5) === "unit=")
                      .split("=")[1],
                    id: queryParams
                      .find((item) => item.slice(0, 3) === "id=")
                      .split("=")[1],
                  })
                );
              } else if (queryParams.includes("page=issues")) {
                sessionStorage.setItem(
                  "selectedIssue",
                  JSON.stringify({
                    plant_id: queryParams
                      .find((item) => item.slice(0, 9) === "plant_id=")
                      .split("=")[1],
                    page: queryParams
                      .find((item) => item.slice(0, 5) === "page=")
                      .split("=")[1],
                    tab: queryParams
                      .find((item) => item.slice(0, 4) === "tab=")
                      .split("=")[1],
                    unit: queryParams
                      .find((item) => item.slice(0, 5) === "unit=")
                      .split("=")[1],
                    id: queryParams
                      .find((item) => item.slice(0, 3) === "id=")
                      .split("=")[1],
                    department: queryParams
                      .find((item) => item.slice(0, 11) === "department=")
                      .split("=")[1],
                  })
                );
              }
            }

            // if (queryParams.includes("module=live-streaming")) {
            //   if (queryParams.includes("page=dashboard")) {
            //     sessionStorage.setItem(
            //       "selectedLiveStreaming",
            //       JSON.stringify({
            //         plant_id: queryParams
            //           .find((item) => item.slice(0, 9) === "plant_id=")
            //           .split("=")[1],
            //         page: queryParams
            //           .find((item) => item.slice(0, 5) === "page=")
            //           .split("=")[1],
            //         unit: queryParams
            //           .find((item) => item.slice(0, 8) === "unit_id=")
            //           .split("=")[1].split('_').join(' '),
            //         id: queryParams
            //           .find((item) => item.slice(0, 3) === "id=")
            //           .split("=")[1],
            //         is_live: queryParams
            //           .find((item) => item.slice(0, 8) === "is_live=")
            //           .split("=")[1],
            //       })
            //     );
            //   } 
            // }

            if (queryParams.includes("module=inspection")) {
              if (queryParams.includes("page=observations")) {
                sessionStorage.setItem(
                  "selectedObservation",
                  JSON.stringify({
                    plant_id: queryParams
                      .find((item) => item.slice(0, 9) === "plant_id=")
                      .split("=")[1],
                    page: queryParams
                      .find((item) => item.slice(0, 5) === "page=")
                      .split("=")[1],
                    unit: queryParams
                      .find((item) => item.slice(0, 5) === "unit=")
                      .split("=")[1].split('+').join(' '),
                    id: queryParams
                      .find((item) => item.slice(0, 3) === "id=")
                      .split("=")[1],
                  })
                );
              }
            }
            sessionStorage.setItem("redirectUrl", "");
            singleSpa.navigateToUrl("/cognito-auth/sign-in");
          } else {
            singleSpa.navigateToUrl("/cognito-auth/sign-in");
          }
          // singleSpa.navigateToUrl("https://mfa-fe-test.auth.ap-northeast-1.amazoncognito.com/login?client_id=32i6c0rd9h4t89rbqpjn1ikaqm&response_type=token&scope=openid&redirect_uri=http://localhost:4200/safety-and-surveillance");
        } else {
          var accessibleModules = JSON.parse(
            sessionStorage.getItem("accessible-modules")
          );
          singleSpa.navigateToUrl(accessibleModules[0].routeUrl);
          window.location.reload();
        }
      }
    });
    if (window.location.pathname.includes("help")) {
      if (
        sessionStorage.getItem("userLoggedIn") == "false" ||
        !sessionStorage.getItem("userLoggedIn")
      ) {
        sessionStorage.clear();
        singleSpa.navigateToUrl("/cognito-auth/sign-in");
      }
    }
    if (window.location.href.split("/").includes("cognito-auth") && window.location.href.split("/").includes("sign-in")) {
      $(function () {
        $.getJSON(
          "assets/json/application-configurations-prod.json",
          function (data) {
            sessionStorage.setItem(
              "application-configuration",
              JSON.stringify(data)
            );
            sessionStorage.setItem("modules", JSON.stringify(data["modules"]));
            sessionStorage.setItem("url", data["url"]);
            sessionStorage.setItem("apiUrl", data["apiUrl"]);
            sessionStorage.setItem("wsUrl", data["websocketUrl"]);
          }
        );
      });
      $(function () {
        $.getJSON("assets/json/host-auth-configurations-prod.json",
          function (data) {
            sessionStorage.setItem("cognito-details", JSON.stringify(data))
          })
      })
      if (window.location.hash != '') {
        sessionStorage.setItem('access-token', window.location.hash.split('#')[1].split('&')[1].split('=')[1])
        window.dispatchEvent(new CustomEvent('ssoLoginEvent'));

        var accessToken = sessionStorage.getItem('access-token');
        var decodedAccessToken = jwt_decode(accessToken)
        sessionStorage.setItem('user-email', decodedAccessToken.email);
        this.tracker.setCustomVariable(1, 'E-mail', decodedAccessToken.email, 'visit');
        sessionStorage.setItem("userLoggedIn", JSON.stringify(true));
        sessionStorage.setItem("welcomeMsgShown", JSON.stringify(false));
        singleSpa.navigateToUrl("/cognito-auth/sign-in")
      }
    }
  </script>
  <import-map-overrides-full style="display: none"></import-map-overrides-full>
</body>

</html>