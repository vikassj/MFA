<div>
  <ng-container *ngIf="!createIncident">
    <div class="position-relative">
      <div class="h-45px bg-white d-flex px-2 position-relative">
        <div
          class="w-25 fs-12px text-color cursor-pointer d-flex ms-3 align-items-center"
          (click)="this.filterPopup = true"
        >
          FILTER
        </div>
        <div
          [ngClass]="
            insightsFound ? 'position-header-btn' : 'position-insights-btn'
          "
          class="ms-1 h-30px d-flex align-items-end"
        >
          <div
            class="d-flex justify-content-between align-items-center fs-12px h-100 w-100"
          >
            <div
              class="menu-bar cursor-pointer w-20 mr-1px h-100 d-flex align-items-center justify-content-center"
              (click)="
                selectOption('verify_initial_report');
                scrollToIncident('verify_initial_report')
              "
              [ngClass]="
                selectedOption == 'verify_initial_report'
                  ? 'bg-blue text-white'
                  : 'bg-light-blue'
              "
            >
              Verify Initial Report
            </div>
            <div
              class="w-20 mr-1px h-100 d-flex align-items-center justify-content-center opacity-75"
              (click)="
                selectOption('evidence_entry');
                scrollToIncident('evidence_entry')
              "
              [ngClass]="{
                'bg-blue text-white': selectedOption == 'evidence_entry',
                'bg-light-blue': selectedOption != 'evidence_entry',
                'cursor-pointer menu-bar opacity-100':
                  selectedFormattedData?.investigators?.length > 0 &&
                  selectedFormattedData?.stakeholders?.length > 0
              }"
            >
              Evidence Entry
            </div>
            <div
              class="w-20 mr-1px h-100 d-flex align-items-center justify-content-center opacity-75"
              (click)="
                selectOption('root_cause_analysis');
                scrollToIncident('root_cause_analysis')
              "
              [ngClass]="{
                'bg-blue text-white': selectedOption == 'root_cause_analysis',
                'bg-light-blue': selectedOption != 'root_cause_analysis',
                'cursor-pointer menu-bar  opacity-100':
                  selectedFormattedData?.investigators?.length > 0 &&
                  selectedFormattedData?.stakeholders?.length > 0 &&
                  ((evidenceData?.length >= 1 && !isAIEnabled) || isAIEnabled)
              }"
            >
              Root Cause Analysis
            </div>
            <div
              class="w-20 mr-1px h-100 d-flex align-items-center justify-content-center opacity-75"
              (click)="selectOption('actions'); scrollToIncident('actions')"
              [ngClass]="{
                'bg-blue text-white': selectedOption == 'actions',
                'bg-light-blue': selectedOption != 'actions',
                'cursor-pointer menu-bar  opacity-100':
                  selectedFormattedData?.investigators?.length > 0 &&
                  selectedFormattedData?.stakeholders?.length > 0 &&
                  ((evidenceData?.length >= 1 && !isAIEnabled) || isAIEnabled)
              }"
            >
              Action
            </div>
            <div
              class="w-20 h-100 d-flex align-items-center justify-content-center opacity-75"
              (click)="selectOption('comment'); scrollToIncident('comment')"
              [ngClass]="{
                'bg-blue text-white': selectedOption == 'comment',
                'bg-light-blue': selectedOption != 'comment',
                'cursor-pointer menu-bar opacity-100':
                  selectedFormattedData?.investigators?.length > 0 &&
                  selectedFormattedData?.stakeholders?.length > 0 &&
                  ((evidenceData?.length >= 1 && !isAIEnabled) || isAIEnabled)
              }"
            >
              Comments
            </div>
          </div>
        </div>
      </div>
      <div class="height p-2" (click)="closeAllOpenBtns()">
        <div class="w-100 h-100 bg-white d-flex" id="incidentList">
          <div class="w-25 p-2">
            <div class="mb-2 d-flex justify-content-between align-items-center">
              <div
                class="text-color fs-11px cursor-pointer"
                (click)="backToOverView()"
              >
                <i class="fas fa-arrow-left pe-2 fs-11px"></i>Back
              </div>
              <div>
                <button
                  class="fs-11px btn btn-sm btn-basic"
                  (click)="createNewIncident()"
                >
                  CREATE NEW INCIDENT
                </button>
              </div>
            </div>
            <div id="overAllIncidents" class="incidentHieght">
              <div id="incident{{ row?.id }}" *ngFor="let row of incidentData">
                <div
                  class="word-break d-flex align-items-center py-2 px-1 cursor-pointer"
                  [ngClass]="
                    selectedFormattedData?.incident_id == row?.incident_id
                      ? 'border-blue'
                      : 'border-bottom border-1'
                  "
                  (click)="selectIncidentViewObj(row); resetShowEvidence()"
                >
                  <div class="w-50 pe-2">
                    <div class="fs-12px text-color fw-800">
                      {{ row?.incident_id }}
                    </div>
                    <div class="fs-11px">
                      <span>{{
                        row?.incident_date | date : "dd MMM yyyy"
                      }}</span>
                      | <span>{{ row?.incident_time }}</span>
                    </div>
                  </div>
                  <div class="w-50 fs-10px">
                    <div
                      class="p-1 px-2 rounded"
                      *ngIf="row.status"
                      [ngClass]="
                        row?.status == 'closed'
                          ? 'status-btn-closed'
                          : 'status-btn-inprogress'
                      "
                    >
                      {{ row?.status | incidentStatus }}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div [ngClass]="insightsFound ? 'w-55' : 'w-75'" class="border">
            <div class="selectedIncidentHeight">
              <div class="w-100 h-100 bg-white p-2">
                <div>
                  <div
                    class="d-flex justify-content-between align-items-center mb-2 fs-10px"
                    *ngIf="
                      selectedFormattedData?.investigators?.length > 0 &&
                      selectedFormattedData?.stakeholders?.length > 0 &&
                      ((evidenceData?.length >= 1 && !isAIEnabled) ||
                        isAIEnabled)
                    "
                  >
                    <div *ngIf="false">
                      <button class="btn btn-sm btn-safe fs-10px">
                        SUBMIT REPORT
                      </button>
                    </div>
                    <div>
                      <div
                        class="p-1 px-2 rounded"
                        *ngIf="selectedFormattedData?.status"
                        [ngClass]="
                          row?.status == 'closed'
                            ? 'status-btn-closed'
                            : 'status-btn-inprogress'
                        "
                      >
                        {{ selectedFormattedData?.status | incidentStatus }}
                      </div>
                    </div>
                    <div>
                      <button
                        class="btn btn-sm btn-safe fs-10px fw-600"
                        [disabled]="
                          !(
                            selectedFormattedData.status ==
                              'capa_in_progress' &&
                            actionStatus &&
                            loginUserId ==
                              selectedFormattedData?.investigators[0]
                          )
                        "
                        (click)="closeIncidentReport()"
                      >
                        CLOSE INCIDENT
                      </button>
                    </div>
                  </div>
                  <div
                    class="d-flex justify-content-between align-items-center fs-10px h-30px"
                  >
                    <div class="drop obj px-2 d-flex align-items-center h-30px">
                      <div class="objs pe-2 px-2">Incident Report Due Date</div>
                      <div class="d-flex align-items-center">
                        <div
                          class="px-1 w-70px text-dark fs-10px"
                          *ngIf="selectedFormattedData?.incident_date"
                        >
                          {{
                            selectedFormattedData?.incident_date
                              | date : "dd MMM yyyy"
                          }}
                        </div>
                        <div
                          class="w-70px text-dark"
                          *ngIf="!selectedFormattedData?.incident_date"
                        >
                          yyyy-MM-dd
                        </div>
                        <div>
                          <i class="px-2 far fa-calendar-alt opacity-75"></i>
                        </div>
                      </div>
                    </div>
                    <div
                      *ngIf="
                        !(
                          selectedFormattedData?.investigators?.length > 0 &&
                          selectedFormattedData?.stakeholders?.length > 0 &&
                          ((evidenceData?.length >= 1 && !isAIEnabled) ||
                            isAIEnabled)
                        )
                      "
                    >
                      <div
                        class="p-1 px-2 rounded"
                        *ngIf="selectedFormattedData?.status"
                        [ngClass]="
                          row?.status == 'closure'
                            ? 'status-btn-closed'
                            : 'status-btn-inprogress'
                        "
                      >
                        {{ selectedFormattedData?.status | incidentStatus }}
                      </div>
                    </div>
                    <div class="drop obj px-2 d-flex align-items-center">
                      <div class="objs pe-2 px-2">Investigation Due Date</div>
                      <div class="d-flex align-items-center">
                        <div
                          class="w-70px text-dark fs-10px px-1"
                          *ngIf="selectedFormattedData?.investigation_due_date"
                        >
                          {{
                            selectedFormattedData?.investigation_due_date
                              | date : "dd MMM yyyy"
                          }}
                        </div>
                        <div
                          class="w-70px text-dark"
                          *ngIf="!selectedFormattedData?.investigation_due_date"
                        >
                          yyyy-MM-dd
                        </div>
                        <div>
                          <i class="px-2 far fa-calendar-alt opacity-75"></i>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div
                    id="incident_report"
                    *ngIf="selectedFormattedData"
                    (scroll)="onContentScroll()"
                    class="mt-2 selectedReportData"
                  >
                    <div
                      class=""
                      id="verify_initial_report"
                      [ngClass]="
                        confirmSubmitUpdateIncident ||
                        !editableField ||
                        !getUserHaveCloseAccess()
                          ? 'disabled'
                          : 'opacity-100'
                      "
                    >
                      <ng-container *ngIf="showAtTop">
                        <div class="fs-12px mt-1">
                          <div class="text-color fw-800 act">Summary</div>
                          <div class="drop p-2 fs-11px bg-ash me-3">
                            <textarea
                              name="Description"
                              [ngClass]="
                                validateField('summary') ? 'required-field' : ''
                              "
                              id=""
                              minlength="0"
                              [disabled]="
                                confirmSubmitUpdateIncident || !editableField
                              "
                              class="w-100 bg-ash break-word p-2 expandable-textarea summary"
                              rows="3"
                              placeholder="Enter summary"
                              [(ngModel)]="selectedFormattedData.summary"
                              (change)="
                                this.selectedFormattedData.summary =
                                  $event.target.value
                              "
                              [style.height]="getTextareaHeight('summary')"
                            ></textarea>
                          </div>
                        </div>
                        <div class="fs-12px mt-1">
                          <div class="text-color fw-800 act">
                            Description of incident
                          </div>
                          <div class="drop p-2 fs-11px bg-ash me-3">
                            <textarea
                              name="Description"
                              id=""
                              [disabled]="
                                confirmSubmitUpdateIncident || !editableField
                              "
                              class="w-100 bg-ash p-2 expandable-textarea description"
                              [ngClass]="
                                validateField('description')
                                  ? 'required-field'
                                  : ''
                              "
                              rows="5"
                              placeholder="Enter Description of incident"
                              [(ngModel)]="selectedFormattedData.description"
                              (change)="
                                this.selectedFormattedData.description =
                                  $event.target.value
                              "
                              [style.height]="getTextareaHeight('description')"
                            ></textarea>
                          </div>
                        </div>
                        <div class="fs-12px mt-1 mb-4">
                          <div class="text-color fw-800 act">
                            Immediate Response
                          </div>
                          <div class="drop p-2 fs-11px bg-ash me-3">
                            <textarea
                              name="Immediate"
                              id=""
                              [disabled]="
                                confirmSubmitUpdateIncident || !editableField
                              "
                              class="w-100 bg-ash p-2 expandable-textarea immediate-response"
                              [ngClass]="
                                validateField('immediate_response')
                                  ? 'required-field'
                                  : ''
                              "
                              rows="5"
                              placeholder="Enter Immediate Response"
                              [(ngModel)]="
                                selectedFormattedData.immediate_response
                              "
                              (change)="
                                this.selectedFormattedData.immediate_response =
                                  $event.target.value
                              "
                              [style.height]="
                                getTextareaHeight('immediate-response')
                              "
                            ></textarea>
                          </div>
                        </div>
                        <div class="fs-11px mt-1 mb-4">
                          <div class="text-color fw-800 act">Investigator</div>
                          <div
                            class="drop px-2 h-32px d-flex align-items-center fs-10px bg-ash w-65"
                          >
                            {{ this.selectedInvestigator?.length }}
                            <ng-container *ngIf="this.selectedInvestigator">
                              <div
                                class="assignee w-20px h-20px rounded-circle d-flex align-items-center justify-content-center me-1"
                              >
                                {{
                                  selectedInvestigator?.name?.slice(0, 1)
                                    | uppercase
                                }}
                              </div>
                              <div
                                class="w-100"
                                id="assignee"
                                [ngClass]="
                                  validateField('investigators')
                                    ? 'required-field'
                                    : ''
                                "
                              >
                                <ng-select
                                  [items]="
                                    allInvestigatorList?.length > 0
                                      ? allInvestigatorList
                                      : []
                                  "
                                  #obsSearch
                                  bindLabel="name"
                                  dropdownPosition="hidden"
                                  [(ngModel)]="selectedInvestigator.name"
                                  placeholder="Select Investigator"
                                  [clearable]="false"
                                  class="custo"
                                  [disabled]="
                                    confirmSubmitUpdateIncident ||
                                    !editableField
                                  "
                                >
                                  <ng-template ng-option-tmp let-item="item">
                                    <p
                                      class="mb-1"
                                      (click)="this.selectedInvestigator = item"
                                    >
                                      <strong>{{
                                        item.name | titlecase
                                      }}</strong>
                                    </p>
                                  </ng-template>
                                </ng-select>
                              </div>
                            </ng-container>
                          </div>
                        </div>
                        <div
                          class="fs-11px mt-1"
                          [ngClass]="
                            !confirmSubmitUpdateIncident
                              ? 'opacity-100'
                              : 'opacity-75'
                          "
                        >
                          <div class="text-color fw-800 act">stakeholders</div>
                          <div
                            class="drop px-2 d-flex flex-column fs-10px bg-ash w-65"
                            style="height: auto"
                            [ngClass]="
                              validateField('stakeholders')
                                ? 'required-field'
                                : ''
                            "
                          >
                            <ng-container
                              *ngIf="
                                selectedFormattedData?.investigators?.length <=
                                  0 &&
                                  selectedFormattedData?.stakeholders?.length <=
                                    0;
                                else displayAllStakeholders
                              "
                            >
                              <div id="assignee" class="">
                                <ng-select
                                  [items]="
                                    allStakeholdersList?.length > 0
                                      ? allStakeholdersList
                                      : []
                                  "
                                  [multiple]="true"
                                  [closeOnSelect]="false"
                                  #obsSearch
                                  bindLabel="email"
                                  dropdownPosition="hidden"
                                  [(ngModel)]="selectedstakeholders"
                                  placeholder="Select stakeholders"
                                  [clearable]="false"
                                  class="custo"
                                  [disabled]="confirmSubmitUpdateIncident"
                                >
                                  <ng-template
                                    ng-option-tmp
                                    let-item="item"
                                    let-item$="item$"
                                    let-index="index"
                                  >
                                    <div
                                      class="d-flex align-items-center stakeholders"
                                    >
                                      <input
                                        id="item-{{ index }}"
                                        type="checkbox"
                                        [checked]="item$.selected"
                                      />
                                      <span class="fs-12 ps-1">{{
                                        item.name | titlecase
                                      }}</span>
                                    </div>
                                  </ng-template>
                                </ng-select>
                              </div>
                            </ng-container>
                            <ng-template #displayAllStakeholders>
                              <div *ngFor="let item of selectedstakeholders">
                                {{ item.email }}
                              </div>
                            </ng-template>
                          </div>
                        </div>
                      </ng-container>

                      <div class="fs-12px mt-1 w-65">
                        <div class="text-color fw-800 act">Plant</div>
                        <div
                          class="drop px-2 h-32px d-flex align-items-center fs-11px bg-ash"
                        >
                          {{ plantName }}
                        </div>
                      </div>
                      <div class="fs-12px mt-1 w-65">
                        <div class="text-color fw-800 act">{{selectedPlantDetails?.[0]?.unit_nomenclature}}</div>
                        <div class="drop px-2 h-32px d-flex align-items-center  fs-11px bg-ash w-100">
                          <div class="dropdown w-100">
                            <div
                              class="text-dark-blue fs-11px ff-montserrat w-100 d-flex justify-content-between align-items-center cursor-pointer"
                              [ngClass]="
                                confirmSubmitUpdateIncident || !editableField
                                  ? 'cursor-menu'
                                  : ''
                              "
                              (click)="unitDropdownShow()"
                            >
                              <div
                                class="fw-800"
                                [title]="selectedFormattedData?.unit_name"
                              >
                                {{ selectedFormattedData?.unit_name }}
                              </div>
                              <div>
                                <img
                                  src="/assets/icons/dropDownArrow.png"
                                  alt=""
                                  width="10px"
                                />
                              </div>
                            </div>
                            <div
                              class="dropdown-style shadow rounded w-100 py-2"
                              *ngIf="unitDropdown"
                            >
                              <div
                                style="font-weight: 800 !important"
                                class="options text-dark-blue fs-11px ff-montserrat"
                                *ngFor="let selectItem of units"
                                [ngClass]="
                                  selectItem == selectedFormattedData?.unit_name
                                    ? 'selected-dropdown'
                                    : ''
                                "
                                (click)="
                                  selectIncidentUnit(selectItem);
                                  this.selectedFormattedData.unit_name =
                                    selectItem
                                "
                              >
                                {{ selectItem }}
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="fs-12px mt-1 w-65">
                        <div class="text-color fw-800 act">{{selectedPlantDetails?.[0]?.zone_nomenclature}}</div>
                        <div class="drop px-2 h-32px d-flex align-items-center  fs-11px bg-ash">
                          <div class="dropdown w-100">
                            <div
                              class="text-dark-blue fs-11px ff-montserrat w-100 d-flex justify-content-between align-items-center cursor-pointer"
                              [ngClass]="
                                confirmSubmitUpdateIncident || !editableField
                                  ? 'cursor-menu'
                                  : ''
                              "
                              (click)="zoneDropdownShow()"
                            >
                              <div
                                class="fw-800"
                                [title]="selectedFormattedData?.zone_name"
                              >
                                {{ selectedFormattedData?.zone_name }}
                              </div>
                              <div>
                                <img
                                  src="/assets/icons/dropDownArrow.png"
                                  alt=""
                                  width="10px"
                                />
                              </div>
                            </div>
                            <div
                              class="dropdown-style shadow rounded w-100 py-2"
                              *ngIf="zoneDropdown"
                            >
                              <div
                                style="font-weight: 800 !important"
                                class="options text-dark-blue fs-11px ff-montserrat"
                                *ngFor="let selectItem of IncidentZonesList"
                                [ngClass]="
                                  selectItem == selectedFormattedData?.zone_name
                                    ? 'selected-dropdown'
                                    : ''
                                "
                                (click)="
                                  selectIncidentZone(selectItem);
                                  this.selectedFormattedData.zone_name =
                                    selectItem
                                "
                              >
                                {{ selectItem }}
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="fs-12px mt-1 w-65">
                        <div class="text-color fw-800 act">
                          Date of Incident
                        </div>
                        <div
                          class="h-32px d-flex align-items-center fs-11px"
                          id="dateSelect"
                        >
                          <mat-form-field>
                            <input
                              matInput
                              id="txtDate"
                              [matDatepicker]="picker1"
                              [(ngModel)]="selectedFormattedData.incident_date"
                              (dateChange)="DateChange($event)"
                              (click)="inputDisabled()"
                              [min]="newDate"
                              [max]="todaysDate"
                              disabled
                            />
                            <mat-datepicker-toggle
                              matSuffix
                              [for]="picker1"
                            ></mat-datepicker-toggle>
                            <mat-datepicker
                              #picker1
                              [disabled]="
                                confirmSubmitUpdateIncident || !editableField
                              "
                            ></mat-datepicker>
                          </mat-form-field>
                        </div>
                      </div>
                      <div class="fs-12px mt-1 w-65">
                        <div class="text-color fw-800 act">
                          Time of Incident
                        </div>
                        <div class="h-32px d-flex align-items-center fs-11px">
                          <input
                            type="time"
                            class="px-2 p-0 h-32px form-control bg-ash incident_date fs-11px fw-800"
                            [ngClass]="
                              validateField('incident_time')
                                ? 'required-field'
                                : ''
                            "
                            *ngIf="selectedFormattedData?.incident_time"
                            [disabled]="confirmSubmitUpdateIncident"
                            [(ngModel)]="
                              selectedFormattedData.incident_time ||
                              !editableField
                            "
                            (change)="
                              this.selectedFormattedData.incident_time =
                                $event.target.value
                            "
                            (change)="timeChange($event)"
                          />
                        </div>
                      </div>
                      <div class="fs-12px mt-1 w-65">
                        <div class="text-color fw-800">
                          Number of Serious injuries
                        </div>
                        <div class="fs-11px">
                          <div
                            class="bg-white h-32px d-flex justify-content-between align-items-center cursor-pointer"
                          >
                            a) Employee
                            <input
                              type="number"
                              min="0"
                              class="drop px-2 p-0 h-100 inputTypeNumber bg-ash"
                              [disabled]="
                                confirmSubmitUpdateIncident || !editableField
                              "
                              [(ngModel)]="
                                selectedFormattedData.serious_injury['employee']
                              "
                              oninput="this.value =
                          !!this.value && Math.abs(this.value) >= 0 ? Math.abs(this.value) : 0"
                            />
                          </div>
                          <div
                            class="bg-white h-32px d-flex justify-content-between align-items-center my-2 cursor-pointer"
                          >
                            b) Contractor
                            <input
                              type="number"
                              min="0"
                              class="drop px-2 p-0 h-100 inputTypeNumber bg-ash"
                              [disabled]="
                                confirmSubmitUpdateIncident || !editableField
                              "
                              [(ngModel)]="
                                selectedFormattedData.serious_injury[
                                  'contractor'
                                ]
                              "
                              oninput="this.value =
                          !!this.value && Math.abs(this.value) >= 0 ? Math.abs(this.value) : 0"
                            />
                          </div>
                          <div
                            class="bg-white h-32px d-flex justify-content-between align-items-center cursor-pointer"
                          >
                            c) Others
                            <input
                              type="number"
                              min="0"
                              class="drop px-2 p-0 h-100 inputTypeNumber bg-ash"
                              [disabled]="
                                confirmSubmitUpdateIncident || !editableField
                              "
                              [(ngModel)]="
                                selectedFormattedData.serious_injury['others']
                              "
                              oninput="this.value =
                          !!this.value && Math.abs(this.value) >= 0 ? Math.abs(this.value) : 0"
                            />
                          </div>
                        </div>
                        <div class="drop px-2 h-32px d-flex align-items-center fw-600 fs-11px d-flex">
                          <label class="mt-2 script d-flex align-items-center me-2" style="color:black;" >
                            Declare lost time injury
                            <input type="checkbox" name="Lost time" [(ngModel)]="selectedFormattedData.lost_time_injury" >
                            <span class="w3docs" ></span>
                          </label>
                      </div>
                      </div>
                      <div class="fs-12px mt-1 w-65">
                        <div class="text-color fw-800">
                          Number of fatalities
                        </div>
                        <div class="fs-11px">
                          <div
                            class="bg-white h-32px d-flex justify-content-between align-items-center cursor-pointer"
                          >
                            a) Employee
                            <input
                              type="number"
                              min="0"
                              class="drop px-2 p-0 h-100 inputTypeNumber bg-ash"
                              [disabled]="
                                confirmSubmitUpdateIncident || !editableField
                              "
                              [(ngModel)]="
                                selectedFormattedData.fatality['employee']
                              "
                              oninput="this.value =
                          !!this.value && Math.abs(this.value) >= 0 ? Math.abs(this.value) : 0"
                            />
                          </div>
                          <div
                            class="bg-white h-32px d-flex justify-content-between align-items-center my-2 cursor-pointer"
                          >
                            b) Contractor
                            <input
                              type="number"
                              min="0"
                              class="drop px-2 p-0 h-100 inputTypeNumber bg-ash"
                              [disabled]="
                                confirmSubmitUpdateIncident || !editableField
                              "
                              [(ngModel)]="
                                selectedFormattedData.fatality['contractor']
                              "
                              oninput="this.value =
                          !!this.value && Math.abs(this.value) >= 0 ? Math.abs(this.value) : 0"
                            />
                          </div>
                          <div
                            class="bg-white h-32px d-flex justify-content-between align-items-center cursor-pointer"
                          >
                            c) Others
                            <input
                              type="number"
                              min="0"
                              class="drop px-2 p-0 h-100 inputTypeNumber bg-ash"
                              [disabled]="
                                confirmSubmitUpdateIncident || !editableField
                              "
                              [(ngModel)]="
                                selectedFormattedData.fatality['others']
                              "
                              oninput="this.value =
                          !!this.value && Math.abs(this.value) >= 0 ? Math.abs(this.value) : 0"
                            />
                          </div>
                        </div>
                      </div>
                      <div class="fs-12px mt-1 w-65">
                        <div class="text-color fw-800">
                          Safety Category (leave blank if no relevant category
                          found)
                        </div>
                        <div class="category">
                          <ng-container
                            *ngIf="
                              !(
                                confirmSubmitUpdateIncident ||
                                !editableField ||
                                !getUserHaveCloseAccess()
                              )
                            "
                          >
                            <ng-select
                              [items]="allCategory"
                              class="fw-600 drop px-2 h-32px d-flex align-items-center fs-11px bg-ash w-100"
                              [multiple]="true"
                              [closeOnSelect]="false"
                              placeholder="Select Safety Category"
                              dropdownPosition="hidden"
                              [(ngModel)]="
                                this.selectedFormattedData.iogpcategories
                              "
                              (change)="changeCategories()"
                              [bindLabel]="'name'"
                              [bindValue]="'acronym'"
                              [clearable]="false"
                            >
                              <ng-template
                                ng-multi-label-tmp
                                let-items="items"
                                let-clear="clear"
                              >
                                <div
                                  class="ng-value"
                                  *ngFor="let item of items | slice : 0 : 2"
                                >
                                  <span class="ng-value-label">{{
                                    item.name
                                  }}</span>
                                  <span
                                    class="ng-value-icon right"
                                    (click)="clear(item)"
                                    aria-hidden="true"
                                    >×</span
                                  >
                                </div>
                                <div class="ng-value" *ngIf="items?.length > 2">
                                  <span class="ng-value-label"
                                    >{{ items?.length - 2 }} more...</span
                                  >
                                </div>
                              </ng-template>
                              <ng-template
                                ng-option-tmp
                                let-item="item"
                                let-item$="item$"
                                let-index="index"
                              >
                                {{ item.name }}
                              </ng-template>
                            </ng-select>
                          </ng-container>
                          <div
                            *ngIf="
                              confirmSubmitUpdateIncident ||
                              !editableField ||
                              !getUserHaveCloseAccess()
                            "
                          >
                            <div
                              *ngFor="
                                let item of selectedFormattedData.iogpcategories;
                                let i = index
                              "
                            >
                              <div *ngFor="let itemCategory of allCategory">
                                <ng-container
                                  *ngIf="item == itemCategory.acronym"
                                >
                                  {{ i + 1 }}) {{ itemCategory.name
                                  }}<span
                                    *ngIf="
                                      selectedFormattedData?.iogpcategories
                                        ?.length !=
                                      i + 1
                                    "
                                    >,</span
                                  >
                                </ng-container>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="fs-12px mt-1 w-65">
                        <div class="text-color fw-800 act">
                          Did the incident cause shutdown or outage of the
                          facility?
                        </div>
                        <div
                          class="drop px-2 h-32px d-flex align-items-center fs-11px bg-ash d-flex align-items-center"
                        >
                          <label
                            class="script d-flex align-items-center me-2"
                            style="color: black"
                            [ngClass]="
                              confirmSubmitUpdateIncident ? 'cursor-menu' : ''
                            "
                          >
                            Yes
                            <input
                              type="radio"
                              name="sms"
                              checked
                              [disabled]="
                                confirmSubmitUpdateIncident || !editableField
                              "
                              (change)="
                                this.selectedFormattedData.is_shutdown = true
                              "
                            />
                            <span class="w3docs"></span>
                          </label>
                          <label
                            class="script d-flex align-items-center me-2"
                            style="color: black"
                          >
                            No
                            <input
                              type="radio"
                              name="sms"
                              [disabled]="
                                confirmSubmitUpdateIncident || !editableField
                              "
                              (change)="
                                this.selectedFormattedData.is_shutdown = false
                              "
                            />
                            <span class="w3docs"></span>
                          </label>
                        </div>
                      </div>
                      <div class="fs-12px mt-1 w-65">
                        <div class="text-color fw-800 act">Sector</div>
                        <div class="drop p-2 fs-11px bg-ash">
                          <ng-container
                            *ngFor="
                              let item of selectedIncidentFormObj?.sector;
                              let i = index
                            "
                          >
                            <div class="mb-2 min-h-23px line-h-10px">
                              <label
                                class="mt-1 script d-flex align-items-center me-2"
                                style="color: black"
                                [ngClass]="
                                  confirmSubmitUpdateIncident
                                    ? 'cursor-menu'
                                    : ''
                                "
                              >
                                {{ item.name }}
                                <input
                                  type="checkbox"
                                  name="sector"
                                  [disabled]="
                                    confirmSubmitUpdateIncident ||
                                    !editableField
                                  "
                                  [checked]="item.checked"
                                  (change)="
                                    selectedCheckList('sector', item, i)
                                  "
                                />
                                <span
                                  class="w3docs"
                                  [ngClass]="[
                                    item.checked ? '' : 'w3docs-disabled',
                                    validateField('sector')
                                      ? 'required-field'
                                      : ''
                                  ]"
                                ></span>
                              </label>
                            </div>
                          </ng-container>
                          <div
                            class="p-2 fs-12px bg-ash"
                            *ngIf="selectedFormattedData['sector']['others']"
                          >
                            <textarea
                              name="Immediate"
                              id=""
                              class="w-100 bg-ash p-2"
                              [ngClass]="
                                validateField('sector_description')
                                  ? 'required-field'
                                  : ''
                              "
                              rows="5"
                              placeholder="Enter Sector"
                              [disabled]="confirmSubmitCreateIncident"
                              [(ngModel)]="
                                selectedFormattedData.sector_description
                              "
                            ></textarea>
                          </div>
                        </div>
                      </div>
                      <div class="fs-12px mt-1 w-65">
                        <div class="text-color fw-800 act">Incident type</div>
                        <div class="drop p-2 fs-11px bg-ash">
                          <ng-container
                            *ngFor="
                              let item of selectedIncidentFormObj?.incident_factor;
                              let i = index
                            "
                          >
                            <div class="mb-2 min-h-23px line-h-10px">
                              <label
                                class="mt-1 script d-flex align-items-center me-2"
                                style="color: black"
                                [ngClass]="
                                  confirmSubmitUpdateIncident
                                    ? 'cursor-menu'
                                    : ''
                                "
                              >
                                {{ item.name }}
                                <input
                                  type="checkbox"
                                  name="type"
                                  [disabled]="
                                    confirmSubmitUpdateIncident ||
                                    !editableField
                                  "
                                  [checked]="item.checked"
                                  (change)="
                                    selectedCheckList(
                                      'incident_factor',
                                      item,
                                      i
                                    )
                                  "
                                />
                                <span
                                  class="w3docs"
                                  [ngClass]="[
                                    item.checked ? '' : 'w3docs-disabled',
                                    validateField('incident_factor')
                                      ? 'required-field'
                                      : ''
                                  ]"
                                ></span>
                              </label>
                            </div>
                          </ng-container>
                          <div
                            class="p-2 fs-12px bg-ash"
                            *ngIf="
                              selectedFormattedData['incident_factor']['others']
                            "
                          >
                            <textarea
                              name="Immediate"
                              id=""
                              class="w-100 bg-ash p-2"
                              [ngClass]="
                                validateField('incident_factor_description')
                                  ? 'required-field'
                                  : ''
                              "
                              rows="5"
                              placeholder="Enter incident type"
                              [disabled]="confirmSubmitCreateIncident"
                              [(ngModel)]="
                                selectedFormattedData.incident_factor_description
                              "
                            ></textarea>
                          </div>
                        </div>
                      </div>
                      <div class="fs-12px mt-1 w-65">
                        <div class="text-color fw-800">
                          Duration of fire - hrs/min
                        </div>
                        <div
                          class="drop px-2 h-32px d-flex align-items-center fs-11px bg-ash"
                        >
                          <input
                            type="number"
                            min="0"
                            class="fs-11px p-0 form-control bg-ash incident_date"
                            [ngClass]="
                              validateField('duration_of_fire') &&
                              selectedFormattedData.incident_factor[
                                'fire_explosion'
                              ]
                                ? 'required-field'
                                : ''
                            "
                            [disabled]="confirmSubmitCreateIncident"
                            [(ngModel)]="selectedFormattedData.duration_of_fire"
                            name="duration_of_fire"
                            [disabled]="
                              confirmSubmitUpdateIncident || !editableField
                            "
                            [(ngModel)]="selectedFormattedData.duration_of_fire"
                          />
                        </div>
                      </div>
                      <div class="fs-12px mt-1 w-65">
                        <div class="text-color fw-800 act">Damages</div>
                        <div class="drop p-2 fs-11px bg-ash">
                          <ng-container
                            *ngFor="
                              let item of selectedIncidentFormObj?.damage;
                              let i = index
                            "
                          >
                            <div class="mb-2 min-h-23px line-h-10px">
                              <label
                                class="mt-1 script d-flex align-items-center me-2"
                                style="color: black"
                                [ngClass]="
                                  confirmSubmitUpdateIncident
                                    ? 'cursor-menu'
                                    : ''
                                "
                              >
                                {{ item.name }}
                                <input
                                  type="checkbox"
                                  name="damage"
                                  [disabled]="
                                    confirmSubmitUpdateIncident ||
                                    !editableField
                                  "
                                  [checked]="item.checked"
                                  (change)="
                                    selectedCheckList('damage', item, i)
                                  "
                                />
                                <span
                                  class="w3docs"
                                  [ngClass]="[
                                    item.checked ? '' : 'w3docs-disabled',
                                    validateField('damage')
                                      ? 'required-field'
                                      : ''
                                  ]"
                                ></span>
                              </label>
                            </div>
                          </ng-container>
                          <div
                            class="p-2 fs-12px bg-ash"
                            *ngIf="selectedFormattedData['damage']['others']"
                          >
                            <textarea
                              name="Immediate"
                              id=""
                              class="w-100 bg-ash p-2"
                              [ngClass]="
                                validateField('damage_description')
                                  ? 'required-field'
                                  : ''
                              "
                              rows="5"
                              placeholder="Enter damage description"
                              [disabled]="confirmSubmitCreateIncident"
                              [(ngModel)]="
                                selectedFormattedData.damage_description
                              "
                            ></textarea>
                          </div>
                        </div>
                      </div>
                      <ng-container *ngIf="!showAtTop">
                        <div class="fs-12px mt-1">
                          <div class="text-color fw-800 act">Summary</div>
                          <div class="drop p-2 fs-11px bg-ash">
                            <textarea
                              name="Description"
                              [ngClass]="
                                validateField('summary') ? 'required-field' : ''
                              "
                              id=""
                              minlength="0"
                              [disabled]="
                                confirmSubmitUpdateIncident || !editableField
                              "
                              class="w-100 bg-ash p-2 expandable-textarea summary"
                              rows="3"
                              placeholder="Enter a brief summary of the incident (e.g., 'Power outage in Building A', 'Data breach detected in system XYZ')."
                              [(ngModel)]="selectedFormattedData.summary"
                              (change)="
                                this.selectedFormattedData.summary =
                                  $event.target.value
                              "
                              [style.height]="getTextareaHeight('summary')"
                            ></textarea>
                          </div>
                        </div>
                        <div class="fs-12px mt-1">
                          <div class="text-color fw-800 act">
                            Description of incident
                          </div>
                          <div class="drop p-2 fs-11px bg-ash">
                            <textarea
                              name="Description"
                              id=""
                              [disabled]="
                                confirmSubmitUpdateIncident || !editableField
                              "
                              class="w-100 bg-ash p-2 expandable-textarea description"
                              [ngClass]="
                                validateField('description')
                                  ? 'required-field'
                                  : ''
                              "
                              rows="5"
                              placeholder="Enter a detailed description of the incident, including relevant times, locations, and any affected systems or personnel."
                              [(ngModel)]="selectedFormattedData.description"
                              (change)="
                                this.selectedFormattedData.description =
                                  $event.target.value
                              "
                              [style.height]="getTextareaHeight('description')"
                            ></textarea>
                          </div>
                        </div>
                        <div class="fs-12px mt-1 mb-4">
                          <div class="text-color fw-800 act">
                            Immediate Response
                          </div>
                          <div class="drop p-2 fs-11px bg-ash">
                            <textarea
                              name="Immediate"
                              id=""
                              [disabled]="
                                confirmSubmitUpdateIncident || !editableField
                              "
                              class="w-100 bg-ash p-2 expandable-textarea immediate-response"
                              [ngClass]="
                                validateField('immediate_response')
                                  ? 'required-field'
                                  : ''
                              "
                              rows="5"
                              placeholder="List any immediate actions taken in response to the incident (e.g., 'Evacuated Building A', 'Isolated affected network’)."
                              [(ngModel)]="
                                selectedFormattedData.immediate_response
                              "
                              (change)="
                                this.selectedFormattedData.immediate_response =
                                  $event.target.value
                              "
                              [style.height]="
                                getTextareaHeight('immediate-response')
                              "
                            ></textarea>
                          </div>
                        </div>
                        <div class="fs-11px mt-1 mb-4">
                          <div class="text-color fw-800 act">
                            Add Investigator
                          </div>
                          <div
                            class="drop px-2 h-32px d-flex align-items-center fs-10px bg-ash"
                          >
                            <ng-container>
                              <div
                                class="assignee w-20px h-20px rounded-circle d-flex align-items-center justify-content-center me-1"
                              >
                                {{
                                  selectedInvestigator?.name?.slice(0, 1)
                                    | uppercase
                                }}
                              </div>
                              <div
                                class="w-100"
                                id="assignee"
                                [ngClass]="
                                  validateField('investigators')
                                    ? 'required-field'
                                    : ''
                                "
                              >
                                <ng-select
                                  [items]="
                                    allInvestigatorList?.length > 0
                                      ? allInvestigatorList
                                      : []
                                  "
                                  #obsSearch
                                  bindLabel="name"
                                  dropdownPosition="hidden"
                                  [(ngModel)]="selectedInvestigator.name"
                                  placeholder="Select Investigator"
                                  [clearable]="false"
                                  class="custo"
                                  [disabled]="
                                    confirmSubmitUpdateIncident ||
                                    !editableField
                                  "
                                >
                                  <ng-template ng-option-tmp let-item="item">
                                    <p
                                      class="mb-1"
                                      (click)="this.selectedInvestigator = item"
                                    >
                                      <strong>{{
                                        item.name | titlecase
                                      }}</strong>
                                    </p>
                                  </ng-template>
                                </ng-select>
                              </div>
                            </ng-container>
                          </div>
                        </div>
                        <div
                          class="fs-11px mt-1"
                          [ngClass]="
                            !confirmSubmitUpdateIncident
                              ? 'opacity-100'
                              : 'opacity-75'
                          "
                        >
                          <div class="text-color fw-800 act">
                            Add stakeholders
                          </div>
                          <div
                            class="drop px-2 d-flex flex-column fs-10px bg-ash"
                            style="height: auto"
                            [ngClass]="
                              validateField('stakeholders')
                                ? 'required-field'
                                : ''
                            "
                          >
                            <ng-container
                              *ngIf="
                                selectedFormattedData?.investigators.length <=
                                  0 &&
                                  selectedFormattedData?.stakeholders.length <=
                                    0;
                                else displayAllStakeholders
                              "
                            >
                              <div id="assignee" class="">
                                <ng-select
                                  [items]="
                                    allStakeholdersList?.length > 0
                                      ? allStakeholdersList
                                      : []
                                  "
                                  [multiple]="true"
                                  [closeOnSelect]="false"
                                  #obsSearch
                                  bindLabel="email"
                                  dropdownPosition="hidden"
                                  [(ngModel)]="selectedstakeholders"
                                  placeholder="Select stakeholders"
                                  [clearable]="false"
                                  class="custo"
                                  [disabled]="confirmSubmitUpdateIncident"
                                >
                                  <ng-template
                                    ng-option-tmp
                                    let-item="item"
                                    let-item$="item$"
                                    let-index="index"
                                  >
                                    <div
                                      class="d-flex align-items-center stakeholders"
                                    >
                                      <input
                                        id="item-{{ index }}"
                                        type="checkbox"
                                        [checked]="item$.selected"
                                      />
                                      <span class="fs-12 ps-1">{{
                                        item.name | titlecase
                                      }}</span>
                                    </div>
                                  </ng-template>
                                </ng-select>
                              </div>
                            </ng-container>
                            <ng-template #displayAllStakeholders>
                              <div *ngFor="let item of selectedstakeholders">
                                {{ item.email }}
                              </div>
                            </ng-template>
                          </div>
                        </div>
                      </ng-container>
                    </div>
                    <ng-container
                      *ngIf="
                        selectedFormattedData?.investigators.length <= 0 &&
                        selectedFormattedData?.stakeholders.length <= 0
                      "
                    >
                      <div class="mt-2" *ngIf="!confirmSubmitUpdateIncident">
                        <button
                          class="btn btn-sm btn-basic me-2 fw-600"
                          (click)="submitUpdateIncidentData()"
                        >
                          SUBMIT
                        </button>
                        <button
                          class="btn btn-sm btn-outline-basic fw-600"
                          (click)="cancelUpdateIncidentData()"
                        >
                          CANCEL
                        </button>
                      </div>
                      <div class="mt-2" *ngIf="confirmSubmitUpdateIncident">
                        <button
                          class="btn btn-sm btn-basic me-2 fw-600"
                          (click)="submittedUpdatedIncidentForm()"
                        >
                          CONFIRM
                        </button>
                        <button
                          class="btn btn-sm btn-outline-basic fw-600"
                          (click)="this.confirmSubmitUpdateIncident = false"
                        >
                          BACK
                        </button>
                      </div>
                    </ng-container>
                    <ng-container
                      *ngIf="
                        selectedFormattedData?.investigators.length > 0 &&
                        selectedFormattedData?.stakeholders.length > 0
                      "
                    >
                      <div
                        class="mt-3"
                        id="evidence_entry"
                        (click)="onContentInteraction('evidence_entry')"
                      >
                        <div class="fs-11px mt-1">
                          <div class="text-color fw-800">Created Evidence</div>
                          <div class="p-2 fs-10px bg-ash">
                            <div class="bg-white" id="incidentList">
                              <ngx-datatable
                                class="material expandable dataTableHeight"
                                [rows]="evidenceData"
                                [columnMode]="'force'"
                                [headerHeight]="30"
                                [rowHeight]="30"
                                [messages]="{
                                  emptyMessage: 'No Evidence recorded'
                                }"
                              >
                                <ngx-datatable-column name="S.No" [width]="10">
                                  <ng-template
                                    let-row="row"
                                    let-rowIndex="rowIndex"
                                    ngx-datatable-cell-template
                                  >
                                    {{ rowIndex + 1 }}
                                  </ng-template>
                                </ngx-datatable-column>
                                <ngx-datatable-column name="Evidence">
                                  <ng-template
                                    let-row="row"
                                    ngx-datatable-cell-template
                                  >
                                    <ng-container
                                      *ngFor="let item of evidence_list"
                                    >
                                      <!-- <div *ngIf="item.id == row.form_id">{{item.name}}</div> -->
                                      <div
                                        *ngIf="
                                          item?.id == row?.form_id &&
                                          item?.name != 'Others'
                                        "
                                      >
                                        {{ item.name }}
                                      </div>
                                      <div
                                        *ngIf="
                                          item?.id == row?.form_id &&
                                          item?.name == 'Others'
                                        "
                                      >
                                        {{ row?.form_values?.name_of_evidence }}
                                      </div>
                                    </ng-container>
                                  </ng-template>
                                </ngx-datatable-column>
                                <ngx-datatable-column>
                                  <ng-template
                                    let-row="row"
                                    ngx-datatable-cell-template
                                  >
                                    <div>
                                      <span
                                        class="text-color me-2 cursor-pointer"
                                        (click)="viewSelectedEvidenceForm(row)"
                                        ><u>View</u></span
                                      >
                                      <span
                                        class="text-danger"
                                        data-bs-toggle="modal"
                                        [ngClass]="
                                          loginUserId ==
                                            selectedFormattedData
                                              ?.investigators[0] &&
                                          selectedFormattedData.status !=
                                            'closed' &&
                                          !showEvidence &&
                                          (evidenceData.length > 1 ||
                                            (lengthOfRcaAndAction?.rca == 0 &&
                                              lengthOfRcaAndAction?.action ==
                                                0))
                                            ? 'cursor-pointer'
                                            : 'disabled'
                                        "
                                        data-bs-target="#confirmSubmit"
                                        (click)="getSelectedEvidenceRow(row)"
                                        ><u>Remove</u></span
                                      >
                                    </div>
                                  </ng-template>
                                </ngx-datatable-column>
                              </ngx-datatable>
                            </div>
                          </div>
                        </div>
                        <div
                          *ngIf="
                            selectedFormattedData.status != 'closed' ||
                            (selectedFormattedData.status == 'closed' &&
                              showEvidence)
                          "
                          class="fs-11px mt-1"
                        >
                          <div class="text-color fw-800">
                            Enter New Evidence
                          </div>
                          <div
                            class="p-2 fs-10px bg-ash d-flex align-items-center flex-wrap"
                          >
                            <div
                              class="evidence-width me-2 mb-2"
                              *ngFor="let item of evidence_list"
                            >
                              <div
                                class="evidence cursor-pointer rounded text-center evidence-width fs-11px"
                                (click)="
                                  this.selectedFormDataId = -1;
                                  selectthisIncidentEvidenceForm(item.id)
                                "
                                [ngClass]="
                                  selected_evidence_id == item.id
                                    ? 'blue-border '
                                    : 'blue-outline-border'
                                "
                              >
                                {{ item.name }}
                              </div>
                            </div>
                          </div>
                          <div
                            class="px-2"
                            [ngClass]="
                              selectedFormattedData.status != 'closed' &&
                              loginUserId ==
                                selectedFormattedData?.investigators[0]
                                ? ''
                                : 'disabled'
                            "
                            id="evidence-start"
                          >
                            <div ngClass="d-flex" class="mb-3">
                              <div class="w-100 pe-1">
                                <div
                                  *ngFor="
                                    let item of inputSchema;
                                    let i = index
                                  "
                                >
                                  <div *ngIf="i + 1 <= inputSchema.length">
                                    <div
                                      class="mb-1 mt-2 d-flex justify-content-between align-items-center"
                                    >
                                      <div>
                                        <p
                                          class="mb-0 fw-bold fs-12 text-color"
                                        >
                                          {{ item.field_label
                                          }}<span
                                            *ngIf="item.is_mandatory"
                                            class="text-danger font-weight-bold"
                                            >*</span
                                          >
                                        </p>
                                      </div>
                                      <div
                                        class="btn-file"
                                        *ngIf="item.field_type === 'file'"
                                      >
                                        <button
                                          class="btn btn-sm browse-btn px-2 fs-10px fw-800"
                                        >
                                          Choose Files
                                        </button>
                                        <input
                                          class="cursorPointer"
                                          type="file"
                                          accept="application/pdf, audio/*, video/*, text/*,image/,application/msword,
                                        application/vnd.openxmlformats-officedocument.wordprocessingml.document, application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
                                          multiple
                                          (change)="
                                            onFileChange(
                                              true,
                                              item.field_key,
                                              $event,
                                              null,
                                              true
                                            )
                                          "
                                          (click)="$event.target.value = null"
                                        />
                                      </div>
                                    </div>
                                    <ng-container
                                      *ngIf="item.field_type === 'text'"
                                    >
                                      <input
                                        type="text"
                                        class="form-control form-control-sm input-fields"
                                        placeholder="Enter {{
                                          item.field_label
                                        }}"
                                        [(ngModel)]="
                                          evidenceFormData[item.field_key]
                                        "
                                      />
                                    </ng-container>
                                    <ng-container
                                      *ngIf="item.field_type === 'mobile'"
                                    >
                                      <input
                                        type="number"
                                        class="form-control form-control-sm input-fields"
                                        placeholder="Enter {{
                                          item.field_label
                                        }}"
                                        [(ngModel)]="
                                          evidenceFormData[item.field_key]
                                        "
                                      />
                                    </ng-container>
                                    <ng-container
                                      *ngIf="item.field_type === 'email'"
                                    >
                                      <input
                                        type="email"
                                        id="{{ item.field_key }}"
                                        class="form-control form-control-sm input-fields"
                                        placeholder="Enter {{
                                          item.field_label
                                        }}"
                                        [(ngModel)]="
                                          evidenceFormData[item.field_key]
                                        "
                                        (blur)="isTouchedField(item.field_key)"
                                      />
                                      <div
                                        *ngIf="
                                          !isValidEmail(
                                            evidenceFormData[item.field_key]
                                          ) && touchedfields[item.field_key]
                                        "
                                        class="error mt-1 text-danger fw-600 fs-10px"
                                      >
                                        Please enter a valid email address.
                                      </div>
                                    </ng-container>
                                    <ng-container
                                      *ngIf="item.field_type === 'textarea'"
                                    >
                                      <textarea
                                        name="textarea"
                                        class="input-fields w-100"
                                        placeholder="Enter {{
                                          item.field_label
                                        }}"
                                        [(ngModel)]="
                                          evidenceFormData[item.field_key]
                                        "
                                        rows="5"
                                      ></textarea>
                                    </ng-container>
                                    <ng-container
                                      *ngIf="item.field_type === 'integer'"
                                    >
                                      <input
                                        type="number"
                                        min="0"
                                        class="form-control form-control-sm inputHeight input-fields"
                                        placeholder="Enter {{
                                          item.field_label
                                        }}"
                                        [(ngModel)]="
                                          evidenceFormData[item.field_key]
                                        "
                                      />
                                    </ng-container>
                                    <ng-container
                                      *ngIf="item.field_type === 'date'"
                                      id="dateSelect"
                                    >
                                      <div
                                        class="d-flex align-items-center fs-11px"
                                        id="dateSelect"
                                      >
                                        <mat-form-field>
                                          <input
                                            matInput
                                            id="txtDate"
                                            [matDatepicker]="picker2"
                                            [(ngModel)]="
                                              evidenceFormData[item.field_key]
                                            "
                                            [max]="todaysDate"
                                            disabled
                                          />
                                          <mat-datepicker-toggle
                                            matSuffix
                                            [for]="picker2"
                                          ></mat-datepicker-toggle>
                                          <mat-datepicker
                                            #picker2
                                            [disabled]="editableField"
                                          ></mat-datepicker>
                                        </mat-form-field>
                                      </div>
                                    </ng-container>
                                    <ng-container
                                      *ngIf="item.field_type === 'checkbox'"
                                    >
                                      <ng-container
                                        *ngFor="
                                          let checkListItem of newIncidentFormObj[
                                            item.field_key
                                          ];
                                          let i = index
                                        "
                                      >
                                        <label
                                          class="mt-1 script d-flex align-items-center me-2"
                                          style="color: black"
                                        >
                                          {{ checkListItem.name }}
                                          <input
                                            type="checkbox"
                                            name="sector"
                                            [checked]="checkListItem.checked"
                                            (change)="
                                              selectEvidenceFormCheckList(
                                                item.field_key,
                                                item,
                                                i
                                              )
                                            "
                                          />
                                          <span
                                            class="w3docs"
                                            [ngClass]="
                                              checkListItem.checked
                                                ? ''
                                                : 'w3docs-disabled'
                                            "
                                          ></span>
                                        </label>
                                        <textarea
                                          class="input-fields"
                                          placeholder="Enter {{
                                            item.field_label
                                          }}"
                                          *ngIf="
                                            checkListItem.name === 'Others' &&
                                            checkListItem.checked
                                          "
                                          rows="4"
                                          cols="50"
                                          [(ngModel)]="
                                            this.newIncidentFormObj[
                                              item.field_key
                                            ][i]['description']
                                          "
                                          (input)="
                                            selectEvidenceFormDescription(
                                              item.field_key,
                                              item,
                                              i
                                            )
                                          "
                                        ></textarea>
                                      </ng-container>
                                    </ng-container>
                                    <ng-container
                                      *ngIf="item.field_type === 'file'"
                                    >
                                      <p class="text-danger font-italic">
                                        File size should not be greater than 5MB
                                      </p>
                                      <div class="border-dashed mh-75px mt-2">
                                        <ng-container
                                          *ngFor="
                                            let file of evidenceFormData[
                                              item.field_key
                                            ];
                                            let j = index
                                          "
                                        >
                                          <div
                                            class="file fs-10px bg-light-basic text-color d-inline-block m-2"
                                          >
                                            {{ returnFileName(file)
                                            }}<i
                                              class="fa fa-times ms-2"
                                              (click)="
                                                removeFile(item.field_key, j)
                                              "
                                            ></i>
                                          </div>
                                        </ng-container>
                                      </div>
                                    </ng-container>
                                    <ng-container
                                      *ngIf="item.field_type === 'boolean'"
                                    >
                                      <div
                                        class="d-flex align-items-center fs-11px d-flex align-items-center"
                                      >
                                        <label
                                          class="script d-flex align-items-center me-2"
                                          style="color: black"
                                        >
                                          Yes
                                          <input
                                            type="radio"
                                            name="{{ item.field_key }}"
                                            [checked]="
                                              evidenceFormData[item.field_key]
                                            "
                                            (change)="
                                              evidenceFormData[
                                                item.field_key
                                              ] = true
                                            "
                                          />
                                          <span class="w3docs"></span>
                                        </label>
                                        <label
                                          class="script d-flex align-items-center me-2"
                                          style="color: black"
                                        >
                                          No
                                          <input
                                            type="radio"
                                            name="{{ item.field_key }}"
                                            [checked]="
                                              !evidenceFormData[item.field_key]
                                            "
                                            (change)="
                                              evidenceFormData[
                                                item.field_key
                                              ] = false
                                            "
                                          />
                                          <span class="w3docs"></span>
                                        </label>
                                      </div>
                                    </ng-container>
                                  </div>
                                </div>
                              </div>
                            </div>
                            <div>
                              <button
                                class="btn btn-sm btn-basic me-2 fw-600"
                                (click)="submitNewEvidenceFormData()"
                                [disabled]="
                                  !getUserHaveViewAccess() ||
                                  validateEvidenceForm() ||
                                  (selectedFormDataId >= 0 && !loginUserId) ||
                                  loginUserId !=
                                    selectedFormattedData?.investigators[0] ||
                                  selectedFormattedData.status == 'closed'
                                "
                              >
                                SAVE
                              </button>
                              <button
                                class="btn btn-sm btn-basic"
                                *ngIf="selectedFormDataId >= 0"
                                (click)="createNewEvidenceFormData()"
                              >
                                Add New Evidence
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>
                      <ng-container
                        *ngIf="
                          (evidenceData.length >= 1 && !isAIEnabled) ||
                          isAIEnabled
                        "
                      >
                        <div
                          id="root_cause_analysis"
                          class="fs-11px mt-3"
                          (click)="onContentInteraction('root_cause_analysis')"
                        >
                          <div class="text-color fw-800">
                            Root Cause Analysis
                          </div>
                          <div class="p-2 fs-10px">
                            <div
                              class="d-flex justify-content-between align-items-center"
                            >
                              <div class="d-flex align-items-center">
                                <div class="pe-3 text-color">
                                  Choose Root Cause Analysis
                                </div>
                                <div class="d-flex align-items-center">
                                  <div>Fishbone method</div>
                                  <div
                                    class="d-flex align-items-center px-3"
                                    style="height: 10.5px"
                                  >
                                    <label class="switch" id="toggals">
                                      <input
                                        type="checkbox"
                                        [checked]="rootAnalysis"
                                        (click)="selectRootAnalysis()"
                                      />
                                      <span class="slider round"></span>
                                    </label>
                                  </div>
                                  <div>Why Why Method</div>
                                </div>
                              </div>
                              <div *ngIf="!rootAnalysis">
                                <button
                                  class="btn btn-sm fishboneBtn bg-white"
                                  [disabled]="
                                    showfishboneNewCategory ||
                                    !getUserHaveCloseAccess() ||
                                    loginUserId !=
                                      selectedFormattedData?.investigators[0] ||
                                    selectedFormattedData.status == 'closed'
                                  "
                                >
                                  <div
                                    class="cursor-pointer fw-500"
                                    (click)="
                                      this.showfishboneNewCategory = true;
                                      scrollToNewCategory()
                                    "
                                  >
                                    + Add new Category
                                  </div>
                                </button>
                              </div>
                            </div>
                            <div
                              class="d-flex mt-2 mh-200px position-relative"
                              [ngClass]="
                                selectedFormattedData.status != 'closed' &&
                                loginUserId ==
                                  selectedFormattedData?.investigators[0]
                                  ? ''
                                  : 'disabled'
                              "
                              *ngIf="!rootAnalysis"
                            >
                              <div class="width-root">
                                <div
                                  id="root-top-card-height"
                                  class="d-flex align-items-end root_cause_width overflow-x"
                                  [ngStyle]="{
                                    'margin-top': getMarginTopHeight() + 'px'
                                  }"
                                >
                                  <ng-container
                                    *ngFor="
                                      let item of fishboneParameter;
                                      let i = index
                                    "
                                  >
                                    <ng-container
                                      *ngIf="
                                        i + 1 <= fishboneParameter.length / 2
                                      "
                                    >
                                      <div
                                        class="min-w-33 pe-2 word-break mb-2"
                                      >
                                        <div
                                          class="w-100 h-30px d-flex align-items-center justify-content-center bg-light-basic text-color"
                                        >
                                          {{ item.name }}
                                        </div>
                                        <div
                                          class="d-flex justify-content-between w-100"
                                        >
                                          <div
                                            id="equipment{{ item.id }}"
                                            class="pe-1 w-100"
                                          >
                                            <div
                                              class="w-100"
                                              *ngFor="
                                                let causeItem of rootCauseAnalysis;
                                                let j = index
                                              "
                                            >
                                              <ng-container
                                                *ngIf="
                                                  causeItem.parameter_id ==
                                                  item.id
                                                "
                                              >
                                                <div class="pb-2 w-100">
                                                  <div
                                                    class="cause d-flex justify-content-between"
                                                  >
                                                    <div class="w-100">
                                                      <textarea
                                                        class="w-100 causeTaskText fs-11"
                                                        id="cause{{ item.id }}{{
                                                          causeItem.id
                                                        }}"
                                                        [ngStyle]="{
                                                          height:
                                                            getCauseTaskTextHeight(
                                                              item.id,
                                                              causeItem.id
                                                            ) + 'px'
                                                        }"
                                                        (click)="
                                                          showCauseBtns(
                                                            causeItem.id
                                                          )
                                                        "
                                                        [disabled]="
                                                          loginUserId !=
                                                          causeItem.created_by
                                                        "
                                                        (focus)="
                                                          showCauseBtns(
                                                            causeItem.id
                                                          )
                                                        "
                                                        [(ngModel)]="
                                                          causeItem.cause
                                                        "
                                                        [ngClass]="
                                                          causeItem.cause == ''
                                                            ? 'visible'
                                                            : 'visible'
                                                        "
                                                        (ngModelChange)="
                                                          saveCauseData(
                                                            item.key + 'Cause',
                                                            item.key,
                                                            item.id
                                                          )
                                                        "
                                                      ></textarea>
                                                    </div>
                                                    <div class="flag">
                                                      <i
                                                        *ngIf="
                                                          !causeItem.mark_as_rca
                                                        "
                                                        class="far fa-bookmark text-warning"
                                                        [ngClass]="
                                                          loginUserId ==
                                                            selectedFormattedData
                                                              ?.investigators[0] &&
                                                          selectedFormattedData.status !=
                                                            'closed'
                                                            ? 'cursor-pointer'
                                                            : 'disabled'
                                                        "
                                                        (click)="
                                                          updateFishboneCause(
                                                            causeItem.id,
                                                            causeItem.cause,
                                                            !causeItem.mark_as_rca
                                                          )
                                                        "
                                                      ></i>
                                                      <i
                                                        *ngIf="
                                                          causeItem.mark_as_rca
                                                        "
                                                        class="fas fa-bookmark text-warning"
                                                        [ngClass]="loginUserId == selectedFormattedData?.investigators[0] && ! (rca_id_list?.['im_fb_cause_id']?.includes(causeItem.id)) && (selectedFormattedData.status != 'closed' ) ? 'cursor-pointer' : 'disabled'"
                                                        (click)="
                                                          updateFishboneCause(
                                                            causeItem.id,
                                                            causeItem.cause,
                                                            !causeItem.mark_as_rca
                                                          )
                                                        "
                                                      ></i>
                                                    </div>
                                                  </div>
                                                  <div
                                                    class="d-flex justify-content-end align-items-center mb-1"
                                                    *ngIf="
                                                      editCauseBtnsShow[
                                                        'causeBtn' +
                                                          causeItem.id
                                                      ]
                                                    "
                                                  >
                                                    <button
                                                      class="btn btn-sm fishboneBtn w-16px h-16px"
                                                      [disabled]="(loginUserId != selectedFormattedData?.investigators[0]) || (rca_id_list?.['im_fb_cause_id']?.includes(causeItem.id)) "
                                                    >
                                                      <div
                                                        class="w-16px h-16px rounded bg-blue d-flex justify-content-center align-items-center me-1 cursor-pointer"
                                                        (click)="
                                                          deleteFishboneCauseSubcause(
                                                            'cause',
                                                            causeItem.id
                                                          )
                                                        "
                                                      >
                                                        <i
                                                          class="fas fa-trash text-white fs-12px"
                                                        ></i>
                                                      </div>
                                                    </button>
                                                    <button
                                                      class="btn btn-sm fishboneBtn w-16px h-16px"
                                                      [disabled]="
                                                        loginUserId !=
                                                        selectedFormattedData
                                                          ?.investigators[0]
                                                      "
                                                    >
                                                      <div
                                                        class="w-16px h-16px rounded bg-blue d-flex justify-content-center align-items-center me-1 cursor-pointer"
                                                        (click)="
                                                          updateFishboneCause(
                                                            causeItem.id,
                                                            causeItem.cause,
                                                            causeItem.mark_as_rca
                                                          )
                                                        "
                                                      >
                                                        <i
                                                          class="far fa-check-circle text-white fs-12px"
                                                        ></i>
                                                      </div>
                                                    </button>
                                                    <button
                                                      class="btn btn-sm fishboneBtn w-16px h-16px"
                                                    >
                                                      <div
                                                        class="w-16px h-16px rounded bg-danger d-flex justify-content-center align-items-center me-1 cursor-pointer"
                                                        (click)="
                                                          cancelFishboneCause()
                                                        "
                                                      >
                                                        <i
                                                          class="far fa-times-circle text-white fs-12px"
                                                        ></i>
                                                      </div>
                                                    </button>
                                                  </div>
                                                  <div
                                                    class="ligh-black pt-1 px-1"
                                                    *ngFor="
                                                      let subCausesItem of causeItem.sub_causes
                                                    "
                                                  >
                                                    <div
                                                      class="d-flex justify-content-between"
                                                    >
                                                      <div>
                                                        <span class="fs-10px"
                                                          >Sub Cause:</span
                                                        >
                                                        <textarea
                                                          class="w-100 break-word subCauseTaskText"
                                                          id="subCauseTaskText{{
                                                            causeItem.id
                                                          }}{{
                                                            subCausesItem.id
                                                          }}"
                                                          [disabled]="
                                                            loginUserId !=
                                                            subCausesItem.created_by
                                                          "
                                                          [ngStyle]="{
                                                            height:
                                                              getSubCauseTaskTextHeight(
                                                                causeItem.id,
                                                                subCausesItem.id
                                                              ) + 'px'
                                                          }"
                                                          (click)="
                                                            showSubCauseBtns(
                                                              causeItem.id,
                                                              subCausesItem.id
                                                            )
                                                          "
                                                          (focus)="
                                                            showSubCauseBtns(
                                                              causeItem.id,
                                                              subCausesItem.id
                                                            )
                                                          "
                                                          [(ngModel)]="
                                                            subCausesItem.sub_cause
                                                          "
                                                        ></textarea>
                                                      </div>
                                                      <div class="flag">
                                                        <i
                                                          *ngIf="
                                                            !subCausesItem.mark_as_rca
                                                          "
                                                          class="far fa-bookmark text-warning"
                                                          [ngClass]="
                                                            loginUserId ==
                                                              selectedFormattedData
                                                                ?.investigators[0] &&
                                                            selectedFormattedData.status !=
                                                              'closed'
                                                              ? 'cursor-pointer'
                                                              : 'disabled'
                                                          "
                                                          (click)="
                                                            updateFishboneSubCause(
                                                              subCausesItem.id,
                                                              subCausesItem.sub_cause,
                                                              !subCausesItem.mark_as_rca
                                                            )
                                                          "
                                                        ></i>
                                                        <i
                                                          *ngIf="
                                                            subCausesItem.mark_as_rca
                                                          "
                                                          class="fas fa-bookmark text-warning"
                                                          [ngClass]="
                                                            loginUserId ==
                                                              selectedFormattedData
                                                                ?.investigators[0] &&
                                                            selectedFormattedData.status !=
                                                              'closed'
                                                              ? 'cursor-pointer'
                                                              : 'disabled'
                                                          "
                                                          (click)="
                                                            updateFishboneSubCause(
                                                              subCausesItem.id,
                                                              subCausesItem.sub_cause,
                                                              !subCausesItem.mark_as_rca
                                                            )
                                                          "
                                                        ></i>
                                                      </div>
                                                    </div>
                                                    <div
                                                      class="d-flex justify-content-end align-items-center pb-1"
                                                      *ngIf="
                                                        editSubCauseBtnsShow[
                                                          'subCauseBtn' +
                                                            causeItem.id +
                                                            '' +
                                                            subCausesItem.id
                                                        ]
                                                      "
                                                    >
                                                      <button
                                                        class="btn btn-sm fishboneBtn w-16px h-16px"
                                                        [disabled]="!subCausesItem.sub_cause || (loginUserId != selectedFormattedData?.investigators[0]) || (rca_id_list?.['im_fb_subcause_id']?.includes(subCausesItem.id))"
                                                      >
                                                        <div
                                                          class="w-16px h-16px rounded bg-blue d-flex justify-content-center align-items-center me-1"
                                                          (click)="
                                                            deleteFishboneCauseSubcause(
                                                              'sub_cause',
                                                              subCausesItem.id
                                                            )
                                                          "
                                                        >
                                                          <i
                                                            class="fas fa-trash text-white fs-12px"
                                                          ></i>
                                                        </div>
                                                      </button>
                                                      <button
                                                        class="btn btn-sm fishboneBtn w-16px h-16px"
                                                        [disabled]="
                                                          !subCausesItem.sub_cause ||
                                                          loginUserId !=
                                                            selectedFormattedData
                                                              ?.investigators[0]
                                                        "
                                                      >
                                                        <div
                                                          class="w-16px h-16px rounded bg-blue d-flex justify-content-center align-items-center me-1 cursor-pointer"
                                                          (click)="
                                                            updateFishboneSubCause(
                                                              subCausesItem.id,
                                                              subCausesItem.sub_cause,
                                                              subCausesItem.mark_as_rca
                                                            )
                                                          "
                                                        >
                                                          <i
                                                            class="far fa-check-circle text-white fs-12px"
                                                          ></i>
                                                        </div>
                                                      </button>
                                                      <button
                                                        class="btn btn-sm fishboneBtn w-16px h-16px"
                                                      >
                                                        <div
                                                          class="w-16px h-16px rounded bg-danger d-flex justify-content-center align-items-center me-1 cursor-pointer"
                                                        >
                                                          <i
                                                            class="far fa-times-circle text-white fs-12px"
                                                          ></i>
                                                        </div>
                                                      </button>
                                                    </div>
                                                  </div>
                                                  <div
                                                    id="{{ item.key }}SubCause{{
                                                      j
                                                    }}"
                                                    class="pt-1 px-1 d-flex justify-content-between align-items-center"
                                                  >
                                                    <div
                                                      class="text-color fs-10px"
                                                      [ngClass]="
                                                        getUserHaveViewAccess() &&
                                                        loginUserId ==
                                                          selectedFormattedData
                                                            ?.investigators[0] &&
                                                        selectedFormattedData.status !=
                                                          'closed'
                                                          ? ' cursor-pointer'
                                                          : 'disabled'
                                                      "
                                                      (click)="
                                                        showSubCause(
                                                          item.key,
                                                          j
                                                        )
                                                      "
                                                    >
                                                      + Sub Cause
                                                    </div>
                                                  </div>
                                                  <div
                                                    class="d-none"
                                                    id="{{ item.key }}{{ j }}"
                                                  >
                                                    <textarea
                                                      class="w-100 break-word incident_date"
                                                      [(ngModel)]="
                                                        fishboneParameterSubCauseObj[
                                                          'subCause' +
                                                            causeItem.id
                                                        ]
                                                      "
                                                      placeholder="Type sub cause here.."
                                                      (ngModelChange)="
                                                        saveSubCauseData(
                                                          item.key,
                                                          j,
                                                          causeItem.id
                                                        )
                                                      "
                                                    ></textarea>
                                                    <div
                                                      class="d-flex justify-content-end align-items-center"
                                                    >
                                                      <button
                                                        class="btn btn-sm fishboneBtn w-16px h-16px"
                                                        [disabled]="
                                                          !fishboneParameterSubCauseObj[
                                                            'subCause' +
                                                              causeItem.id
                                                          ]
                                                        "
                                                      >
                                                        <div
                                                          class="w-16px h-16px rounded bg-blue d-flex justify-content-center align-items-center me-1 cursor-pointer"
                                                          (click)="
                                                            submitSubCause(
                                                              item.key,
                                                              j,
                                                              causeItem.id
                                                            )
                                                          "
                                                        >
                                                          <i
                                                            class="far fa-check-circle text-white fs-12px"
                                                          ></i>
                                                        </div>
                                                      </button>
                                                      <button
                                                        class="btn btn-sm fishboneBtn w-16px h-16px"
                                                      >
                                                        <div
                                                          class="w-16px h-16px rounded bg-danger d-flex justify-content-center align-items-center me-1 cursor-pointer"
                                                          (click)="
                                                            cancelSubCause(
                                                              item.key,
                                                              j,
                                                              causeItem.id
                                                            )
                                                          "
                                                        >
                                                          <i
                                                            class="far fa-times-circle text-white fs-12px"
                                                          ></i>
                                                        </div>
                                                      </button>
                                                    </div>
                                                  </div>
                                                </div>
                                              </ng-container>
                                            </div>
                                            <div
                                              id="{{ item.key }}CauseBtn"
                                              class="fs-12px"
                                              [ngClass]="
                                                getUserHaveViewAccess() &&
                                                loginUserId ==
                                                  selectedFormattedData
                                                    ?.investigators[0] &&
                                                selectedFormattedData.status !=
                                                  'closed'
                                                  ? ' cursor-pointer'
                                                  : 'disabled'
                                              "
                                              (click)="
                                                createCause(item.key + 'Cause')
                                              "
                                            >
                                              + Cause
                                            </div>
                                            <div
                                              id="{{ item.key }}Cause"
                                              class="d-none"
                                            >
                                              <textarea
                                                class="w-100 break-word incident_date"
                                                [(ngModel)]="
                                                  fishboneParameter[item.key]
                                                "
                                                placeholder="Type cause here.."
                                                (ngModelChange)="
                                                  saveCauseData(
                                                    item.key + 'Cause',
                                                    item.key,
                                                    item.id
                                                  )
                                                "
                                              ></textarea>
                                              <div
                                                class="d-flex justify-content-end align-items-center"
                                              >
                                                <button
                                                  class="btn btn-sm fishboneBtn w-16px h-16px"
                                                  [disabled]="
                                                    !fishboneParameter[item.key]
                                                  "
                                                >
                                                  <div
                                                    class="w-16px h-16px rounded bg-blue d-flex justify-content-center align-items-center me-1 cursor-pointer"
                                                    (click)="
                                                      submitCause(
                                                        item.key + 'Cause',
                                                        item.key,
                                                        item.id
                                                      )
                                                    "
                                                  >
                                                    <i
                                                      class="far fa-check-circle text-white fs-12px"
                                                    ></i>
                                                  </div>
                                                </button>
                                                <button
                                                  class="fishboneBtn w-16px h-16px"
                                                >
                                                  <div
                                                    class="w-16px h-16px rounded bg-danger d-flex justify-content-center align-items-center me-1 cursor-pointer"
                                                    (click)="
                                                      cancelCause(
                                                        item.key + 'Cause',
                                                        item.key,
                                                        item.id
                                                      )
                                                    "
                                                  >
                                                    <i
                                                      class="far fa-times-circle text-white fs-12px"
                                                    ></i>
                                                  </div>
                                                </button>
                                              </div>
                                            </div>
                                          </div>
                                          <div class="w-4px">
                                            <div
                                              class="border-left-blue h-100"
                                            ></div>
                                            <div
                                              class="w-10px margin-downarrow"
                                            >
                                              <i
                                                class="fas fa-caret-down text-color fs-18px line-h-10px"
                                              ></i>
                                            </div>
                                          </div>
                                        </div>
                                      </div>
                                    </ng-container>
                                  </ng-container>
                                  <div
                                    id="newCategory"
                                    class="min-w-33 pe-2 word-break mb-2"
                                    *ngIf="showfishboneNewCategory"
                                  >
                                    <div
                                      class="w-100 h-30px d-flex align-items-center justify-content-center bg-light-basic text-color"
                                    >
                                      <input
                                        type="text"
                                        class="w-100 h-100 bg-light-basic text-color border-0"
                                        [(ngModel)]="fishboneNewCategory.name"
                                        placeholder="Enter new Category"
                                      />
                                    </div>
                                    <div
                                      class="d-flex justify-content-between w-100"
                                    >
                                      <div class="pe-1 w-100">
                                        <div id="Cause" class="">
                                          <textarea
                                            class="w-100 break-word incident_date"
                                            [(ngModel)]="
                                              fishboneNewCategory.description
                                            "
                                            placeholder="Type description here.."
                                          ></textarea>
                                          <div
                                            class="d-flex justify-content-end align-items-center"
                                          >
                                            <button
                                              class="btn btn-sm fishboneBtn w-16px h-16px"
                                              [disabled]="
                                                !(
                                                  fishboneNewCategory?.name &&
                                                  fishboneNewCategory?.description
                                                )
                                              "
                                            >
                                              <div
                                                class="w-16px h-16px rounded bg-blue d-flex justify-content-center align-items-center me-1 cursor-pointer"
                                                (click)="submitNewCategory()"
                                              >
                                                <i
                                                  class="far fa-check-circle text-white fs-12px"
                                                ></i>
                                              </div>
                                            </button>
                                            <button
                                              class="btn btn-sm fishboneBtn w-16px h-16px"
                                            >
                                              <div
                                                class="w-16px h-16px rounded bg-danger d-flex justify-content-center align-items-center me-1 cursor-pointer"
                                                (click)="cancelNewCategory()"
                                              >
                                                <i
                                                  class="far fa-times-circle text-white fs-12px"
                                                ></i>
                                              </div>
                                            </button>
                                          </div>
                                        </div>
                                      </div>
                                      <div class="w-4px">
                                        <div
                                          class="border-left-blue h-100"
                                        ></div>
                                        <div class="w-10px margin-downarrow">
                                          <i
                                            class="fas fa-caret-down text-color fs-18px line-h-10px"
                                          ></i>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                                <div
                                  class="d-flex align-items-center line-h-4px"
                                >
                                  <div
                                    class="border-blue line-h-4px border_line_width"
                                  ></div>
                                  <div
                                    class="w-10px"
                                    style="margin-left: -0.3px"
                                  >
                                    <i
                                      class="fas fa-caret-right text-color fs-18px line-h-10px"
                                    ></i>
                                  </div>
                                </div>
                                <div
                                  class="d-flex align-items-start root_cause_width overflow-x"
                                >
                                  <ng-container
                                    *ngFor="
                                      let item of fishboneParameter;
                                      let i = index
                                    "
                                  >
                                    <ng-container
                                      *ngIf="
                                        i + 1 > fishboneParameter.length / 2
                                      "
                                    >
                                      <div
                                        class="min-w-33 pe-2 mt-2 word-break"
                                      >
                                        <div
                                          class="d-flex justify-content-between"
                                        >
                                          <div
                                            id="equipment{{ item.id }}"
                                            class="pe-1 w-100"
                                          >
                                            <div
                                              class="w-100"
                                              *ngFor="
                                                let causeItem of rootCauseAnalysis;
                                                let j = index
                                              "
                                            >
                                              <ng-container
                                                *ngIf="
                                                  causeItem.parameter_id ==
                                                  item.id
                                                "
                                              >
                                                <div class="pb-2 w-100">
                                                  <div
                                                    class="cause d-flex justify-content-between"
                                                  >
                                                    <div class="w-100">
                                                      <textarea
                                                        class="w-100 break-word causeTaskText fs-11"
                                                        id="cause{{ item.id }}{{
                                                          causeItem.id
                                                        }}"
                                                        [ngStyle]="{
                                                          height:
                                                            getCauseTaskTextHeight(
                                                              item.id,
                                                              causeItem.id
                                                            ) + 'px'
                                                        }"
                                                        (click)="
                                                          showCauseBtns(
                                                            causeItem.id
                                                          )
                                                        "
                                                        [disabled]="
                                                          loginUserId !=
                                                          causeItem.created_by
                                                        "
                                                        (focus)="
                                                          showCauseBtns(
                                                            causeItem.id
                                                          )
                                                        "
                                                        [(ngModel)]="
                                                          causeItem.cause
                                                        "
                                                      ></textarea>
                                                    </div>
                                                    <div class="flag">
                                                      <i
                                                        *ngIf="
                                                          !causeItem.mark_as_rca
                                                        "
                                                        class="far fa-bookmark text-warning"
                                                        [ngClass]="
                                                          loginUserId ==
                                                            selectedFormattedData
                                                              ?.investigators[0] &&
                                                          selectedFormattedData.status !=
                                                            'closed'
                                                            ? 'cursor-pointer'
                                                            : 'disabled'
                                                        "
                                                        (click)="
                                                          updateFishboneCause(
                                                            causeItem.id,
                                                            causeItem.cause,
                                                            !causeItem.mark_as_rca
                                                          )
                                                        "
                                                      ></i>
                                                      <i
                                                        *ngIf="
                                                          causeItem.mark_as_rca
                                                        "
                                                        class="fas fa-bookmark text-warning"
                                                        [ngClass]="(loginUserId == selectedFormattedData?.investigators[0]) &&!(rca_id_list?.['im_fb_cause_id']?.includes(causeItem.id)) && (selectedFormattedData.status != 'closed' ) ? 'cursor-pointer' : 'disabled'"
                                                        (click)="
                                                          updateFishboneCause(
                                                            causeItem.id,
                                                            causeItem.cause,
                                                            !causeItem.mark_as_rca
                                                          )
                                                        "
                                                      ></i>
                                                    </div>
                                                  </div>
                                                  <div
                                                    class="d-flex justify-content-end align-items-center mb-1"
                                                    *ngIf="
                                                      editCauseBtnsShow[
                                                        'causeBtn' +
                                                          causeItem.id
                                                      ]
                                                    "
                                                  >
                                                    <button
                                                      class="btn btn-sm fishboneBtn w-16px h-16px"
                                                      [disabled]="(loginUserId != selectedFormattedData?.investigators[0]) || (rca_id_list?.['im_fb_cause_id']?.includes(causeItem.id))"
                                                    >
                                                      <div
                                                        class="w-16px h-16px rounded bg-blue d-flex justify-content-center align-items-center me-1 cursor-pointer"
                                                        (click)="
                                                          deleteFishboneCauseSubcause(
                                                            'cause',
                                                            causeItem.id
                                                          )
                                                        "
                                                      >
                                                        <i
                                                          class="fas fa-trash text-white fs-12px"
                                                        ></i>
                                                      </div>
                                                    </button>
                                                    <button
                                                      class="btn btn-sm fishboneBtn w-16px h-16px"
                                                      [disabled]="
                                                        !causeItem.cause ||
                                                        loginUserId !=
                                                          selectedFormattedData
                                                            ?.investigators[0]
                                                      "
                                                    >
                                                      <div
                                                        class="w-16px h-16px rounded bg-blue d-flex justify-content-center align-items-center me-1 cursor-pointer"
                                                        (click)="
                                                          updateFishboneCause(
                                                            causeItem.id,
                                                            causeItem.cause,
                                                            causeItem.mark_as_rca
                                                          )
                                                        "
                                                      >
                                                        <i
                                                          class="far fa-check-circle text-white fs-12px"
                                                        ></i>
                                                      </div>
                                                    </button>
                                                    <button
                                                      class="btn btn-sm fishboneBtn w-16px h-16px"
                                                    >
                                                      <div
                                                        class="w-16px h-16px rounded bg-danger d-flex justify-content-center align-items-center me-1 cursor-pointer"
                                                      >
                                                        <i
                                                          class="far fa-times-circle text-white fs-12px"
                                                        ></i>
                                                      </div>
                                                    </button>
                                                  </div>
                                                  <div
                                                    class="ligh-black pt-1 px-1"
                                                    *ngFor="
                                                      let subCausesItem of causeItem.sub_causes
                                                    "
                                                  >
                                                    <div
                                                      class="d-flex justify-content-between"
                                                    >
                                                      <div>
                                                        <span class="fs-10px"
                                                          >Sub Cause:-</span
                                                        >
                                                        <textarea
                                                          class="w-100 break-word subCauseTaskText"
                                                          id="subCauseTaskText{{
                                                            causeItem.id
                                                          }}{{
                                                            subCausesItem.id
                                                          }}"
                                                          [disabled]="
                                                            loginUserId !=
                                                            subCausesItem.created_by
                                                          "
                                                          [ngStyle]="{
                                                            height:
                                                              getSubCauseTaskTextHeight(
                                                                causeItem.id,
                                                                subCausesItem.id
                                                              ) + 'px'
                                                          }"
                                                          (click)="
                                                            showSubCauseBtns(
                                                              causeItem.id,
                                                              subCausesItem.id
                                                            )
                                                          "
                                                          (focus)="
                                                            showSubCauseBtns(
                                                              causeItem.id,
                                                              subCausesItem.id
                                                            )
                                                          "
                                                          [(ngModel)]="
                                                            subCausesItem.sub_cause
                                                          "
                                                        ></textarea>
                                                      </div>
                                                      <div class="flag">
                                                        <i
                                                          *ngIf="
                                                            !subCausesItem.mark_as_rca
                                                          "
                                                          class="far fa-bookmark text-warning"
                                                          [ngClass]="
                                                            loginUserId ==
                                                              selectedFormattedData
                                                                ?.investigators[0] &&
                                                            selectedFormattedData.status !=
                                                              'closed'
                                                              ? 'cursor-pointer'
                                                              : 'disabled'
                                                          "
                                                          (click)="
                                                            updateFishboneSubCause(
                                                              subCausesItem.id,
                                                              subCausesItem.sub_cause,
                                                              !subCausesItem.mark_as_rca
                                                            )
                                                          "
                                                        ></i>
                                                        <i
                                                          *ngIf="
                                                            subCausesItem.mark_as_rca
                                                          "
                                                          class="fas fa-bookmark text-warning"
                                                          [ngClass]="
                                                            loginUserId ==
                                                              selectedFormattedData
                                                                ?.investigators[0] &&
                                                            selectedFormattedData.status !=
                                                              'closed'
                                                              ? 'cursor-pointer'
                                                              : 'disabled'
                                                          "
                                                          (click)="
                                                            updateFishboneSubCause(
                                                              subCausesItem.id,
                                                              subCausesItem.sub_cause,
                                                              !subCausesItem.mark_as_rca
                                                            )
                                                          "
                                                        ></i>
                                                      </div>
                                                    </div>
                                                    <div
                                                      class="d-flex justify-content-end align-items-center pb-1"
                                                      *ngIf="
                                                        editSubCauseBtnsShow[
                                                          'subCauseBtn' +
                                                            causeItem.id +
                                                            '' +
                                                            subCausesItem.id
                                                        ]
                                                      "
                                                    >
                                                      <button
                                                        class="btn btn-sm fishboneBtn w-16px h-16px"
                                                        [disabled]="(loginUserId != selectedFormattedData?.investigators[0]) || (rca_id_list?.['im_fb_subcause_id']?.includes(subCausesItem.id))"
                                                      >
                                                        <div
                                                          class="w-16px h-16px rounded bg-blue d-flex justify-content-center align-items-center me-1"
                                                          (click)="
                                                            deleteFishboneCauseSubcause(
                                                              'sub_cause',
                                                              subCausesItem.id
                                                            )
                                                          "
                                                        >
                                                          <i
                                                            class="fas fa-trash text-white fs-12px"
                                                          ></i>
                                                        </div>
                                                      </button>
                                                      <button
                                                        class="btn btn-sm fishboneBtn w-16px h-16px"
                                                        [disabled]="
                                                          !subCausesItem.sub_cause ||
                                                          loginUserId !=
                                                            selectedFormattedData
                                                              ?.investigators[0]
                                                        "
                                                      >
                                                        <div
                                                          class="w-16px h-16px rounded bg-blue d-flex justify-content-center align-items-center me-1 cursor-pointer"
                                                          (click)="
                                                            updateFishboneSubCause(
                                                              subCausesItem.id,
                                                              subCausesItem.sub_cause,
                                                              subCausesItem.mark_as_rca
                                                            )
                                                          "
                                                        >
                                                          <i
                                                            class="far fa-check-circle text-white fs-12px"
                                                          ></i>
                                                        </div>
                                                      </button>
                                                      <button
                                                        class="btn btn-sm fishboneBtn w-16px h-16px"
                                                      >
                                                        <div
                                                          class="w-16px h-16px rounded bg-danger d-flex justify-content-center align-items-center me-1 cursor-pointer"
                                                        >
                                                          <i
                                                            class="far fa-times-circle text-white fs-12px"
                                                          ></i>
                                                        </div>
                                                      </button>
                                                    </div>
                                                  </div>
                                                  <div
                                                    id="{{ item.key }}SubCause{{
                                                      j
                                                    }}"
                                                    class="pt-1 px-1 d-flex justify-content-between align-items-center"
                                                  >
                                                    <div
                                                      class="text-color fs-10px"
                                                      [ngClass]="
                                                        getUserHaveViewAccess() &&
                                                        loginUserId ==
                                                          selectedFormattedData
                                                            ?.investigators[0] &&
                                                        selectedFormattedData.status !=
                                                          'closed'
                                                          ? ' cursor-pointer'
                                                          : 'disabled'
                                                      "
                                                      (click)="
                                                        showSubCause(
                                                          item.key,
                                                          j
                                                        )
                                                      "
                                                    >
                                                      + Sub Cause
                                                    </div>
                                                  </div>
                                                  <div
                                                    class="d-none"
                                                    id="{{ item.key }}{{ j }}"
                                                  >
                                                    <textarea
                                                      class="w-100 break-word incident_date"
                                                      placeholder="Type sub cause here.."
                                                      [(ngModel)]="
                                                        fishboneParameterSubCauseObj[
                                                          'subCause' +
                                                            causeItem.id
                                                        ]
                                                      "
                                                      (ngModelChange)="
                                                        saveSubCauseData(
                                                          item.key,
                                                          j,
                                                          causeItem.id
                                                        )
                                                      "
                                                    ></textarea>
                                                    <div
                                                      class="d-flex justify-content-end align-items-center"
                                                    >
                                                      <button
                                                        class="btn btn-sm fishboneBtn w-16px h-16px"
                                                        [disabled]="
                                                          !fishboneParameterSubCauseObj[
                                                            'subCause' +
                                                              causeItem.id
                                                          ]
                                                        "
                                                      >
                                                        <div
                                                          class="w-16px h-16px rounded bg-blue d-flex justify-content-center align-items-center me-1 cursor-pointer"
                                                          (click)="
                                                            submitSubCause(
                                                              item.key,
                                                              j,
                                                              causeItem.id
                                                            )
                                                          "
                                                        >
                                                          <i
                                                            class="far fa-check-circle text-white fs-12px"
                                                          ></i>
                                                        </div>
                                                      </button>
                                                      <button
                                                        class="btn btn-sm fishboneBtn w-16px h-16px"
                                                      >
                                                        <div
                                                          class="w-16px h-16px rounded bg-danger d-flex justify-content-center align-items-center me-1 cursor-pointer"
                                                          (click)="
                                                            cancelSubCause(
                                                              item.key,
                                                              j,
                                                              causeItem.id
                                                            )
                                                          "
                                                        >
                                                          <i
                                                            class="far fa-times-circle text-white fs-12px"
                                                          ></i>
                                                        </div>
                                                      </button>
                                                    </div>
                                                  </div>
                                                </div>
                                              </ng-container>
                                            </div>
                                            <div
                                              id="{{ item.key }}CauseBtn"
                                              class="fs-12px"
                                              [ngClass]="
                                                getUserHaveViewAccess() &&
                                                loginUserId ==
                                                  selectedFormattedData
                                                    ?.investigators[0] &&
                                                selectedFormattedData.status !=
                                                  'closed'
                                                  ? ' cursor-pointer'
                                                  : 'disabled'
                                              "
                                              (click)="
                                                createCause(item.key + 'Cause')
                                              "
                                            >
                                              + Cause
                                            </div>
                                            <div
                                              id="{{ item.key }}Cause"
                                              class="d-none"
                                            >
                                              <textarea
                                                class="w-100 break-word incident_date"
                                                [(ngModel)]="
                                                  fishboneParameter[item.key]
                                                "
                                                (ngModelChange)="
                                                  saveCauseData(
                                                    item.key + 'Cause',
                                                    item.key,
                                                    item.id
                                                  )
                                                "
                                                placeholder="Type cause here.."
                                              ></textarea>
                                              <div
                                                class="d-flex justify-content-end align-items-center"
                                              >
                                                <button
                                                  class="btn btn-sm fishboneBtn w-16px h-16px"
                                                  [disabled]="
                                                    !fishboneParameter[item.key]
                                                  "
                                                >
                                                  <div
                                                    class="w-16px h-16px rounded bg-blue d-flex justify-content-center align-items-center me-1 cursor-pointer"
                                                    (click)="
                                                      submitCause(
                                                        item.key + 'Cause',
                                                        item.key,
                                                        item.id
                                                      )
                                                    "
                                                  >
                                                    <i
                                                      class="far fa-check-circle text-white fs-12px"
                                                    ></i>
                                                  </div>
                                                </button>

                                                <button
                                                  class="fishboneBtn w-16px h-16px"
                                                >
                                                  <div
                                                    class="w-16px h-16px rounded bg-danger d-flex justify-content-center align-items-center me-1 cursor-pointer"
                                                    (click)="
                                                      cancelCause(
                                                        item.key + 'Cause',
                                                        item.key,
                                                        item.id
                                                      )
                                                    "
                                                  >
                                                    <i
                                                      class="far fa-times-circle text-white fs-12px"
                                                    ></i>
                                                  </div>
                                                </button>
                                              </div>
                                            </div>
                                          </div>
                                          <div class="w-4px">
                                            <div
                                              class="w-10px h-7px margin-uparrow"
                                            >
                                              <i
                                                class="fas fa-caret-up text-color fs-18px line-h-10px"
                                              ></i>
                                            </div>
                                            <div
                                              class="border-left-blue h-100"
                                            ></div>
                                          </div>
                                        </div>
                                        <div
                                          class="w-100 h-30px d-flex align-items-center justify-content-center bg-light-basic text-color"
                                        >
                                          {{ item.name }}
                                        </div>
                                      </div>
                                    </ng-container>
                                  </ng-container>
                                </div>
                              </div>
                              <div
                                id="root-left-card-height"
                                class="left-rootCause"
                                [ngStyle]="{
                                  top: getTopPositionHeight() + 'px'
                                }"
                              >
                                <div
                                  class="text-color fs-12 fw-800 text-center"
                                >
                                  Problem
                                </div>
                                <div
                                  class="w-100px mh-200px ligh-black d-flex align-items-center"
                                >
                                  <div class="w-100 h-100 position-relative">
                                    <div class="mh-75px position-relative">
                                      <img
                                        src="/assets/icons/rootAnalysis.png"
                                        width="100%"
                                        alt=""
                                      />
                                      <div
                                        class="w-100 h-100 d-flex pt-8px align-items-center position-left-card-text px-2 text-white"
                                      >
                                        {{ selectedFormattedData?.summary }}
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                            <!-- <div class="mt-2"  *ngIf="!rootAnalysis">
                                <button class="btn btn-sm btn-basic me-2 fw-600" [disabled]="isEmptyObject(fishBoneSavedData['subcauses']) && isEmptyObject(fishBoneSavedData['causes']) " (click)="onFishBoneSave()" >SAVE</button>
                                <button class="btn btn-sm btn-basic fw-600" [disabled]="isEmptyObject(fishBoneSavedData['subcauses']) && isEmptyObject(fishBoneSavedData['causes']) " (click)="onFishBoneCancel()">Cancel</button>
                            </div> -->
                            <div
                              [ngClass]="
                                selectedFormattedData.status != 'closed' &&
                                loginUserId ==
                                  selectedFormattedData?.investigators[0]
                                  ? ''
                                  : 'disabled'
                              "
                              *ngIf="rootAnalysis"
                            >
                              <ng-container
                                *ngFor="
                                  let item of whywhyQuestionAnalysis;
                                  let i = index
                                "
                              >
                                <div class="pt-2">
                                  <div>
                                    <div class="pb-1">
                                      <span class="text-color pe-2">WHY</span>
                                      <span>
                                        <textarea
                                          class="drop w-100 break-word subAnsTaskText"
                                          style="
                                            padding-left: 10px;
                                            padding-top: 6px;
                                          "
                                          (click)="showQuestionBtns(item.id)"
                                          (focus)="showQuestionBtns(item.id)"
                                          [disabled]="
                                            loginUserId != item.created_by
                                          "
                                          [(ngModel)]="item.question"
                                        ></textarea>
                                      </span>
                                      <div
                                        id="question{{ item.id }}"
                                        class="d-flex justify-content-end align-items-center pb-1"
                                        *ngIf="
                                          whywhyQuestionBtns[
                                            'question' + item.id
                                          ]
                                        "
                                      >
                                        <button
                                          class="btn btn-sm fishboneBtn w-16px h-16px"
                                          [disabled]="
                                            loginUserId !=
                                              selectedFormattedData
                                                ?.investigators[0] ||
                                            item.id != latestQuestion.id
                                          "
                                        >
                                          <div
                                            class="w-16px h-16px rounded bg-blue d-flex justify-content-center align-items-center me-1"
                                            (click)="
                                              deleteAns('question', item.id)
                                            "
                                          >
                                            <i
                                              class="fas fa-trash text-white fs-12px"
                                            ></i>
                                          </div>
                                        </button>
                                        <button
                                          class="btn btn-sm fishboneBtn w-16px h-16px"
                                        >
                                          <div
                                            class="w-16px h-16px rounded bg-blue d-flex justify-content-center align-items-center me-1 cursor-pointer"
                                            (click)="
                                              updateQuestion(
                                                item.id,
                                                item.question
                                              )
                                            "
                                          >
                                            <i
                                              class="far fa-check-circle text-white fs-12px"
                                            ></i>
                                          </div>
                                        </button>
                                        <button
                                          class="btn btn-sm fishboneBtn w-16px h-16px"
                                        >
                                          <div
                                            class="w-16px h-16px rounded bg-danger d-flex justify-content-center align-items-center cursor-pointer"
                                            (click)="cancelQuestion(item.id)"
                                          >
                                            <i
                                              class="far fa-times-circle text-white fs-12px"
                                            ></i>
                                          </div>
                                        </button>
                                      </div>
                                    </div>
                                    <div class="drop bg-light-ash p-2">
                                      <ng-container
                                        *ngFor="let ans of item.answers"
                                      >
                                        <div
                                          class="d-flex justify-content-between"
                                        >
                                          <div class="w-100">
                                            <textarea
                                              class="drop w-100 break-word subAnsTaskText"
                                              (click)="
                                                showAnsBtns(item.id, ans.id)
                                              "
                                              (focus)="
                                                showAnsBtns(item.id, ans.id)
                                              "
                                              [disabled]="
                                                loginUserId != item.created_by
                                              "
                                              [(ngModel)]="ans.answer"
                                            ></textarea>
                                          </div>
                                          <div class="ps-2">
                                            <i
                                              *ngIf="!ans.mark_as_rca"
                                              class="far fa-bookmark text-warning"
                                              [ngClass]="
                                                loginUserId ==
                                                  selectedFormattedData
                                                    ?.investigators[0] &&
                                                selectedFormattedData.status !=
                                                  'closed'
                                                  ? 'cursor-pointer'
                                                  : 'disabled'
                                              "
                                              (click)="
                                                updateAnsRca(
                                                  ans.id,
                                                  ans.answer,
                                                  !ans.mark_as_rca
                                                )
                                              "
                                            ></i>
                                            <i
                                              *ngIf="ans.mark_as_rca"
                                              class="fas fa-bookmark text-warning"
                                              [ngClass]="loginUserId == selectedFormattedData?.investigators[0] &&!(rca_id_list?.['im_ww_answer_id']?.includes(ans.id)) && (selectedFormattedData.status != 'closed' ) ? 'cursor-pointer' : 'disabled'"
                                              (click)="
                                                updateAnsRca(
                                                  ans.id,
                                                  ans.answer,
                                                  !ans.mark_as_rca
                                                )
                                              "
                                            ></i>
                                          </div>
                                        </div>
                                        <div
                                          class="d-flex justify-content-end align-items-center pb-1"
                                          *ngIf="
                                            whywhyAnsBtns[
                                              'ans' + item.id + ans.id
                                            ]
                                          "
                                        >
                                          <button
                                            class="btn btn-sm fishboneBtn w-16px h-16px"
                                            [disabled]="!ans.answer"
                                          >
                                            <div
                                              class="w-16px h-16px rounded bg-blue d-flex justify-content-center align-items-center me-1 cursor-pointer"
                                              (click)="
                                                updateAns(
                                                  ans.id,
                                                  ans.answer,
                                                  ans.mark_as_rca
                                                )
                                              "
                                            >
                                              <i
                                                class="far fa-check-circle text-white fs-12px"
                                              ></i>
                                            </div>
                                          </button>
                                          <button
                                            class="btn btn-sm fishboneBtn w-16px h-16px"
                                          >
                                            <div
                                              class="w-16px h-16px rounded bg-danger d-flex justify-content-center align-items-center cursor-pointer"
                                              (click)="
                                                cancelAns(item.id, ans.id)
                                              "
                                            >
                                              <i
                                                class="far fa-times-circle text-white fs-12px"
                                              ></i>
                                            </div>
                                          </button>
                                        </div>
                                      </ng-container>
                                      <ng-container>
                                        <div id="addAns{{ i }}" class="d-none">
                                          <textarea
                                            class="drop w-100 break-word subAnsTaskText"
                                            [(ngModel)]="
                                              whyPostAns['ans' + item.id]
                                            "
                                            placeholder="Type answer here.."
                                          ></textarea>
                                          <div
                                            class="d-flex justify-content-end align-items-center"
                                          >
                                            <button
                                              class="btn btn-sm fishboneBtn w-16px h-16px"
                                              [disabled]="
                                                !whyPostAns['ans' + item.id]
                                              "
                                            >
                                              <div
                                                class="w-16px h-16px rounded bg-blue d-flex justify-content-center align-items-center me-1 cursor-pointer"
                                                (click)="
                                                  submitNewAns(
                                                    item.id,
                                                    whyPostAns['ans' + item.id],
                                                    i
                                                  )
                                                "
                                              >
                                                <i
                                                  class="far fa-check-circle text-white fs-12px"
                                                ></i>
                                              </div>
                                            </button>
                                            <button
                                              class="fishboneBtn w-16px h-16px"
                                            >
                                              <div
                                                class="w-16px h-16px rounded bg-danger d-flex justify-content-center align-items-center me-1 cursor-pointer"
                                                (click)="
                                                  cancelNewAns(item.id, i)
                                                "
                                              >
                                                <i
                                                  class="far fa-times-circle text-white fs-12px"
                                                ></i>
                                              </div>
                                            </button>
                                          </div>
                                        </div>
                                      </ng-container>
                                    </div>
                                  </div>
                                </div>
                              </ng-container>
                              <div class="mt-2">
                                <div class="w-100">
                                  <textarea
                                    class="drop break-word w-100 fs-11"
                                    placeholder="Enter the question for why why method"
                                    [(ngModel)]="this.question"
                                  ></textarea>
                                </div>
                                <div class="w-100">
                                  <textarea
                                    class="drop break-word w-100 fs-11"
                                    placeholder="Enter the answer for why why method"
                                    [(ngModel)]="this.answer"
                                  ></textarea>
                                </div>
                                <button
                                  class="btn btn-sm btn-basic mt-2 fs-11px fw-600 w-70px"
                                  [disabled]="
                                    !getUserHaveCloseAccess() ||
                                    loginUserId !=
                                      selectedFormattedData?.investigators[0] ||
                                    selectedFormattedData.status == 'closed' ||
                                    !this.question?.length ||
                                    !this.answer?.length
                                  "
                                  (click)="postQuestionAnalysis()"
                                >
                                  + ADD
                                </button>
                                <button
                                  class="btn btn-sm btn-basic fs-11px fw-600 w-70px cancel"
                                  [disabled]="
                                    !getUserHaveCloseAccess() ||
                                    loginUserId !=
                                      selectedFormattedData?.investigators[0] ||
                                    selectedFormattedData.status == 'closed' ||
                                    !this.question?.length ||
                                    !this.answer?.length
                                  "
                                  (click)="cancelWhyQuestion()"
                                >
                                  CANCEL
                                </button>
                              </div>
                            </div>
                          </div>
                        </div>
                        <button
                          class="btn btn-sm btn-basic mt-2 fs-11px fw-600 w-70px"
                          *ngIf="isAIEnabled"
                          [disabled]="
                            !getUserHaveCloseAccess() ||
                            loginUserId !=
                              selectedFormattedData?.investigators[0] ||
                            lengthOfRcaAndAction?.rca == 0 ||
                            lengthOfRcaAndAction?.action > 0
                          "
                          (click)="triggerAIActionCreation()"
                        >
                          SUBMIT
                        </button>
                        <p
                          *ngIf="isAIEnabled"
                          class="text-danger font-italic mt-2"
                        >
                          Press SUBMIT button only if all root cause(s) are
                          identified.
                        </p>
                        <div
                          id="actions"
                          class="fs-11px mt-3"
                          (click)="onContentInteraction('actions')"
                        >
                          <div class="text-color fw-800">
                            Corrective and Preventive Actions
                          </div>
                          <div class="p-2 fs-10px">
                            <app-incident-actions
                              [rootCauseAnalysis]="rootCauseAnalysis"
                              [whywhyQuestionAnalysis]="whywhyQuestionAnalysis"
                              [allUserList]="allUserList"
                              [loginUserId]="loginUserId"
                              [incidentId]="selectedFormattedData.id"
                              [selectedFormattedData]="selectedFormattedData"
                              [allPlantUsers]="allPlantUsers"
                              [closeAccessList]="allInvestigatorList"
                              (rcaAndActionCount)="rcaAndActionCount($event)"
                              (findOpenStatusActions)="
                                findOpenStatusActions($event)
                              "
                              (rca_id_list)="getRcaIdList($event)"
                            ></app-incident-actions>
                          </div>
                        </div>
                        <div
                          id="comment"
                          class="fs-11px mt-3"
                          (click)="onContentInteraction('comment')"
                        >
                          <app-incidet-chatbox
                            [faultId]="selectedIncidentObj?.id"
                            [loginUserId]="loginUserId"
                            [selectedUnit]="selectedUnitName"
                            [commentTagging]="commentTagging"
                          ></app-incidet-chatbox>
                        </div>
                      </ng-container>
                    </ng-container>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div *ngIf="insightsFound" class="w-20 h-100 bg-light-black">
            <div
              class="bg-blue text-white text-center p-2"
              id="right-insight-header"
            >
              <div class="fs-11px text-center">INSIGHTS</div>
            </div>
            <div
              class="w-100 p-2 overflow"
              [ngStyle]="{
                height: 'calc(100% - ' + getMostCriticalTableHeight() + 'px)'
              }"
            >
              <ng-container *ngIf="insightsAvailable && insightsData?.length">
                <div *ngFor="let item of insightsData; let i = index">
                  <div class="bg-white rounded fs-11px mb-2 p-2">
                    <div>
                      <div
                        class="d-flex align-items-center justify-content-between"
                      >
                        <div class="pe-2 text-color w-100">
                          {{ item?.title }}
                        </div>
                        <div class="pe-2" (click)="showAndHide(i)">
                          <i
                            [ngClass]="item.view ? 'd-none' : 'd-block'"
                            class="fas fa-angle-down text-color"
                          ></i>
                          <i
                            [ngClass]="!item.view ? 'd-none' : 'd-block'"
                            class="fas fa-angle-up text-color"
                          ></i>
                        </div>
                        <div
                          class="cursor-pointer"
                          [ngClass]="true ? 'd-block' : 'd-none'"
                          (click)="
                            item.pin ? unPinInsight(item) : pinInsight(item)
                          "
                        >
                          <img
                            [src]="pinIcon"
                            class="h-16px"
                            *ngIf="item.pin"
                          />
                          <img
                            [src]="unPinIcon"
                            class="h-16px"
                            *ngIf="!item.pin"
                          />
                        </div>
                      </div>
                    </div>
                    <div
                      class="pt-2"
                      [ngClass]="!item.view ? 'd-none' : 'd-block'"
                    >
                      <div class="opacity-75">{{ item?.description }}</div>
                      <div *ngFor="let incidentItem of item?.observation">
                        <div class="opacity-75">* {{ incidentItem }}</div>
                      </div>
                    </div>
                  </div>
                </div>
              </ng-container>
              <div
                class="h-100 d-flex justify-content-center align-items-center"
                *ngIf="!insightsAvailable"
              >
                <p
                  class="w-55 text-center"
                  style="font-size: 10px; color: #6b6b6b; font-style: italic"
                >
                  Insights will be available in the investigation phase.
                </p>
              </div>
              <div
                class="h-100 d-flex justify-content-center align-items-center"
                *ngIf="
                  insightsLoading &&
                  selectedFormattedData.status != 'incident_logged'
                "
              >
                <p
                  class="w-55 text-center"
                  style="font-size: 10px; color: #6b6b6b; font-style: italic"
                >
                  Fetching Insights.
                </p>
              </div>
              <div
                class="h-100 d-flex justify-content-center align-items-center"
                *ngIf="
                  !insightsData?.length &&
                  insightsAvailable &&
                  !pinnedInsights?.length &&
                  !this.insightsLoading
                "
              >
                <p
                  class="w-55 text-center"
                  style="font-size: 10px; color: #6b6b6b; font-style: italic"
                >
                  No insights to show.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div
        class="filter-popup col-2 min-w-200px bg-body p-2"
        *ngIf="filterPopup"
      >
        <div class="d-flex mb-2">
          <button
            id="back-button"
            (click)="this.filterPopup = false"
            style="margin-right: auto"
          >
            <i class="fas fa-arrow-left"></i>
          </button>
          <button
            class="btn btn-basic btn-sm me-2 w-60px fw-600 px-2 fs-11"
            (click)="applyFilters()"
            [disabled]="disableApply"
          >
            APPLY
          </button>
          <button
            class="btn btn-outline-basic btn-sm w-60px fw-600 px-2 fs-11"
            (click)="onFilterReset()"
          >
            RESET
          </button>
        </div>
        <div>
          <div class="select-vehicle">
            <fieldset class="side-bar-fieldset">
              <legend class="side-bar-legend">Due Date</legend>
              <ng-select
                [items]="dueDates"
                [multiple]="true"
                [closeOnSelect]="false"
                [(ngModel)]="selectedDates"
                placeholder="Select dates"
                (ngModelChange)="onFilterChange()"
                [closeOnSelect]="false"
              >
                <ng-template
                  ng-multi-label-tmp
                  let-items="items"
                  let-clear="clear"
                >
                  <div
                    class="ng-value"
                    *ngFor="let item of items | slice : 0 : 1"
                  >
                    <span class="ng-value-label" [title]="item">{{
                      item
                    }}</span>
                    <span
                      class="ng-value-icon right"
                      (click)="clear(item)"
                      aria-hidden="true"
                      >×</span
                    >
                  </div>
                  <div class="ng-value" *ngIf="items.length > 1">
                    <span class="ng-value-label"
                      >{{ items.length - 1 }} more...</span
                    >
                  </div>
                </ng-template>
                <ng-template
                  ng-option-tmp
                  let-item="item"
                  let-item$="item$"
                  let-index="index"
                >
                  <div class="d-flex align-items-center stakeholders">
                    <input
                      id="item-{{ index }}"
                      type="checkbox"
                      [checked]="item$.selected"
                    />
                    <span class="fs-12 ps-1">{{
                      item | date : "dd MMM yyyy"
                    }}</span>
                  </div>
                </ng-template>
                <ng-template ng-footer-tmp>
                  <div class="d-flex justify-content-between">
                    <button
                      (click)="selectedAllDates()"
                      class="btn btn-sm btn-basic fs-10px"
                    >
                      Select all
                    </button>
                    <button
                      (click)="unSelectAllDates()"
                      class="btn btn-sm btn-basic ms-2 fs-10px"
                    >
                      Unselect all
                    </button>
                  </div>
                </ng-template>
              </ng-select>
            </fieldset>
          </div>
          <div class="select-vehicle">
            <fieldset class="side-bar-fieldset">
              <legend class="side-bar-legend">Reporter</legend>
              <ng-select
                [items]="reporters"
                [multiple]="true"
                [closeOnSelect]="false"
                [(ngModel)]="selectedReporter"
                placeholder="Select reporter"
                (ngModelChange)="onFilterChange()"
                [closeOnSelect]="false"
                bindLabel="name"
                dropdownPosition="hidden"
              >
                <ng-template
                  ng-multi-label-tmp
                  let-items="items"
                  let-clear="clear"
                >
                  <div
                    class="ng-value"
                    *ngFor="let item of items | slice : 0 : 1"
                  >
                    <span class="ng-value-label" [title]="item.name">{{
                      item.name
                    }}</span>
                    <span
                      class="ng-value-icon right"
                      (click)="clear(item)"
                      aria-hidden="true"
                      >×</span
                    >
                  </div>
                  <div class="ng-value" *ngIf="items.length > 1">
                    <span class="ng-value-label"
                      >{{ items.length - 1 }} more...</span
                    >
                  </div>
                </ng-template>
                <ng-template
                  ng-option-tmp
                  let-item="item"
                  let-item$="item$"
                  let-index="index"
                >
                  <div class="d-flex align-items-center stakeholders">
                    <input
                      id="item-{{ index }}"
                      type="checkbox"
                      [checked]="item$.selected"
                    />
                    <span class="fs-12 ps-1">{{ item.name | titlecase }}</span>
                  </div>
                </ng-template>
                <ng-template ng-footer-tmp>
                  <div class="d-flex justify-content-between">
                    <button
                      (click)="selectedAllReporters()"
                      class="btn btn-sm btn-basic fs-10px"
                    >
                      Select all
                    </button>
                    <button
                      (click)="unSelectAllReporters()"
                      class="btn btn-sm btn-basic ms-2 fs-10px"
                    >
                      Unselect all
                    </button>
                  </div>
                </ng-template>
              </ng-select>
            </fieldset>
          </div>
          <div class="select-vehicle">
            <fieldset class="side-bar-fieldset">
              <legend class="side-bar-legend">Investigator</legend>
              <ng-select
                [items]="investigators?.length > 0 ? investigators : []"
                [multiple]="true"
                [closeOnSelect]="false"
                #obsSearch
                bindLabel="name"
                dropdownPosition="hidden"
                [(ngModel)]="selectedInvestigators"
                (ngModelChange)="onFilterChange()"
                placeholder="Select investigators"
                [clearable]="false"
                class="custo"
                [disabled]="confirmSubmitUpdateIncident"
              >
                <ng-template
                  ng-multi-label-tmp
                  let-items="items"
                  let-clear="clear"
                >
                  <div
                    class="ng-value"
                    *ngFor="let item of items | slice : 0 : 1"
                  >
                    <span class="ng-value-label" [title]="item.name">{{
                      item.name
                    }}</span>
                    <span
                      class="ng-value-icon right"
                      (click)="clear(item)"
                      aria-hidden="true"
                      >×</span
                    >
                  </div>
                  <div class="ng-value" *ngIf="items.length > 1">
                    <span class="ng-value-label"
                      >{{ items.length - 1 }} more...</span
                    >
                  </div>
                </ng-template>
                <ng-template
                  ng-option-tmp
                  let-item="item"
                  let-item$="item$"
                  let-index="index"
                >
                  <div class="d-flex align-items-center stakeholders">
                    <input
                      id="item-{{ index }}"
                      type="checkbox"
                      [checked]="item$.selected"
                    />
                    <span class="fs-12 ps-1">{{ item.name | titlecase }}</span>
                  </div>
                </ng-template>
                <ng-template ng-footer-tmp>
                  <div class="d-flex justify-content-between">
                    <button
                      (click)="selectedAllInvestigators()"
                      class="btn btn-sm btn-basic fs-10px"
                    >
                      Select all
                    </button>
                    <button
                      (click)="unSelectAllInvestigators()"
                      class="btn btn-sm btn-basic ms-2 fs-10px"
                    >
                      Unselect all
                    </button>
                  </div>
                </ng-template>
              </ng-select>
            </fieldset>
          </div>
          <div class="select-vehicle">
            <fieldset class="side-bar-fieldset">
              <legend class="side-bar-legend">Status</legend>
              <ng-select
                [items]="status"
                [multiple]="true"
                [closeOnSelect]="false"
                [(ngModel)]="selectedStatus"
                placeholder="Select status"
                (ngModelChange)="onFilterChange()"
                [closeOnSelect]="false"
              >
                <ng-template
                  ng-multi-label-tmp
                  let-items="items"
                  let-clear="clear"
                >
                  <div
                    class="ng-value"
                    *ngFor="let item of items | slice : 0 : 1"
                  >
                    <span class="ng-value-label" [title]="item">{{
                      item | incidentStatus
                    }}</span>
                    <span
                      class="ng-value-icon right"
                      (click)="clear(item)"
                      aria-hidden="true"
                      >×</span
                    >
                  </div>
                  <div class="ng-value" *ngIf="items.length > 1">
                    <span class="ng-value-label"
                      >{{ items.length - 1 }} more...</span
                    >
                  </div>
                </ng-template>
                <ng-template
                  ng-option-tmp
                  let-item="item"
                  let-item$="item$"
                  let-index="index"
                >
                  <div class="d-flex align-items-center stakeholders">
                    <input
                      id="item-{{ index }}"
                      type="checkbox"
                      [checked]="item$.selected"
                    />
                    <span class="fs-12 ps-1">{{ item | incidentStatus }}</span>
                  </div>
                </ng-template>
                <ng-template ng-footer-tmp>
                  <div class="d-flex justify-content-between">
                    <button
                      (click)="selectedAllStatus()"
                      class="btn btn-sm btn-basic fs-10px"
                    >
                      Select all
                    </button>
                    <button
                      (click)="unSelectAllStatus()"
                      class="btn btn-sm btn-basic ms-2 fs-10px"
                    >
                      Unselect all
                    </button>
                  </div>
                </ng-template>
              </ng-select>
            </fieldset>
          </div>
        </div>
      </div>
    </div>
  </ng-container>

  <ng-container *ngIf="createIncident">
    <app-incident-create
      [units]="units"
      [zonesList]="zonesList"
      [loginUserId]="loginUserId"
      (backToIncidentPage)="closeCreateIncident($event)"
    ></app-incident-create>
  </ng-container>
</div>

<div
  class="modal fade blur_background"
  id="confirmSubmit"
  data-bs-backdrop="static"
  data-bs-keyboard="false"
  tabindex="-1"
  aria-labelledby="addObservationLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="px-3 pt-2 text-center">
        <div class="fs-12px">Are you sure you want to delete the evidence?</div>
      </div>
      <div
        class="text-center p-3 d-flex align-items-center justify-content-center fs-12px"
      >
        <button
          type="button"
          class="btn btn-sm btn-basic w-60px p-1px"
          (click)="deleteEvidenceForm(selectedEvidenceRow)"
        >
          YES
        </button>
        <button
          type="button"
          class="btn btn-sm btn-danger w-60px p-1px ms-2"
          data-bs-dismiss="modal"
        >
          NO
        </button>
      </div>
    </div>
  </div>
</div>

<div
  class="modal fade blur_background"
  id="validateField"
  data-bs-backdrop="static"
  data-bs-keyboard="false"
  tabindex="-1"
  aria-labelledby="addObservationLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="px-3 pt-2 text-center">
        <div class="fs-12px">
          Please provide valid data for all required fields.
        </div>
      </div>
      <div
        class="text-center p-3 d-flex align-items-center justify-content-center fs-12px"
      >
        <button
          type="button"
          class="btn btn-sm btn-basic w-60px p-1px"
          data-bs-dismiss="modal"
        >
          OK
        </button>
      </div>
    </div>
  </div>
</div>
